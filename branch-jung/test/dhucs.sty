% This is file `dhucs.sty`.
%
% Copyright (C) 2004-2006 Dohyun Kim <nomosnomos at gmail.com>
%                     and Karnes Kim <karnes at doeun.pe.kr>
%
% -------------------------------------------------------------------
% This program is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation; either version 2 of the License, or
% (at your option) any later version.
%   
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program; if not, write to the Free Software
% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
% -------------------------------------------------------------------
%
\NeedsTeXFormat{LaTeX2e}

\ProvidesPackage{dhucs}
  [2006/09/07 v3.0.3 typesetting UTF-8 Korean documents]

%% french spacing is default
\frenchspacing
%% Options. hangul, nonfrench, nojosa, hanja.
\DeclareOption{nonfrench}{\nonfrenchspacing}
\newif\if@hangul\@hangulfalse
\DeclareOption{hangul}{\@hangultrue}
\newif\if@nojosa\@nojosafalse
\DeclareOption{nojosa}{\@nojosatrue}
\newif\if@hanja\@hanjafalse
\DeclareOption{hanja}{\@hanjatrue\if@hangul\else\@hangultrue\fi}
\ProcessOptions
%% load ucs(aka. unicode) package.
%%% do not support old version of ucs package anymore.
\RequirePackage[utf8x]{inputenc}
\input lucenc.def
\DeclareFontSubstitution{LUC}{unbt}{m}{n}
%%%%%
\DeclareRobustCommand\SetHangulFonts[3]{%
    \def\serifhangulfont{#1}%
    \def\sanshangulfont{#2}%
    \def\monohangulfont{#3}%
}
\DeclareRobustCommand\SetHanjaFonts[3]{%
    \def\serifhanjafont{#1}%
    \def\sanshanjafont{#2}%
    \def\monohanjafont{#3}%
}
\DeclareRobustCommand\SetSerifFonts[2]{%
    \def\serifhangulfont{#1}%
    \def\serifhanjafont{#2}%
}
\DeclareRobustCommand\SetSansFonts[2]{%
    \def\sanshangulfont{#1}%
    \def\sanshanjafont{#2}%
}
\DeclareRobustCommand\SetAdhocFonts[2]{%
    \def\serifhangulfont{#1}%
    \def\sanshangulfont{#1}%
    \def\monohangulfont{#1}%
    \def\serifhanjafont{#2}%
    \def\sanshanjafont{#2}%
    \def\monohanjafont{#2}%
}
\SetHangulFonts{unbt}{ungt}{untz}
\SetHanjaFonts{unbt}{ungt}{ungtz}
%%%%%%%%%
%%% To make the width of tt-family korean symbols wide,
%%% do something like this:
%\expandafter\def\expandafter\ttfamily\expandafter{\ttfamily
%  \DeclareUnicodeCharacter{"00B7}{\hbox to 1em{\hss\textperiodcentered\hss}}%
%}
%%%%%%%%%
%% inter-hangul chars glue(skip).
%% default -.0852em for UnFonts.
\newlength\inter@hangul@skip
\setlength\inter@hangul@skip{-.0852em}
%% dhucs-interword.sty will use this command.
\newcommand*\setInterHangulSkip[1]{\setlength\inter@hangul@skip{#1}}
%% ...
\newcommand*\hfontfamilynameprefix{un}
%%
\mathchardef\Hangul@spacefactor=1001
%%
\renewcommand*{\unichar}[1]{%
  \ifnum #1<8448 %%% "2100
    \uni@char{#1}\else
  \ifnum #1<64256 %%% "FB00
    \unihangulchar{#1}\else
  \ifnum #1<65280 %%% "FF00
    \uni@char{#1}%
  \else
    \unihangulchar{#1}\fi\fi\fi
  \BreakBeforeAsciiOParen{#1}%
}
\DeclareRobustCommand*\unihangulchar[1]{% assume #1 = "AC01
  \getmyLUCfont{#1}%
  \breakbeforehangulchar{#1}% allow linebreak before hangul chars
  \begingroup
  \fontencoding{LUC}\fontfamily{\myLUCfont}\lucchar{#1}%
  % BANGJEOM emphasis
  \ifnum #1>13311 \ifnum #1<64256 % hangul, hanja
    \dhucs@emph{\lucchar{#1}}% 
  \fi\fi
  \endgroup
  \josa@buf@del\global\@josa=#1 % autojosa
  \hangulspacefactor{#1}% insert hangul spacefactor
}
\newcommand*\getmyLUCfont[1]{%
  \def\hangul@hanja{hanja}%
  \ifnum #1>44031 \ifnum #1<55204 % 가..힣
    \def\hangul@hanja{hangul}\fi\fi
  \edef\tempa{\f@family}%
  \edef\tempb{\rmdefault}%
  \edef\tempc{\sfdefault}%
  \ifx\tempa\tempb
    \edef\myLUCfont{\csname serif\hangul@hanja font\endcsname}%
  \else\ifx\tempa\tempc
    \edef\myLUCfont{\csname sans\hangul@hanja font\endcsname}%
  \else
    \edef\myLUCfont{\csname mono\hangul@hanja font\endcsname}%
    \let\breakbeforehangulchar\@gobble
    \let\BreakBeforeAsciiOParen\@gobble
  \fi\fi
}
% disallow linebreak after OP
\sfcode`\(=998
\sfcode`\`=998
\sfcode`\[=998
\newcommand*\breakbeforehangulchar[1]{%
  \ifhmode
  \ifdim\lastskip=\z@
  \ifnum\spacefactor>998
  \ifnum #1>13311   % >= "3400 CJK Unified Ideographs Ext A
    \ifnum #1<64255 % <= "FAFF CJK Compatibility Ideographs
      \ifnum\spacefactor=\Hangul@spacefactor
        \discretionaryorglue
      \else
        \breakafterasciichar
      \fi
    \else% full width, half width forms
      \breakbeforecjkoparen{#1}%
    \fi
  \else% #1 <= 13311
    \ifnum #1>12352
      \ifnum #1<12544 % hiragana, katagana
        \insertjapaneseglue{#1}%
      \fi
    \else% #1 <= 12352
      \breakbeforecjkoparen{#1}%
    \fi
  \fi
  \fi\fi\fi
}
\newcommand*\discretionaryorglue{%
  \discretionary{}{}{\kern\inter@hangul@skip}%
}
\newcommand*\breakafterasciichar{%
    \hskip\z@
}
\newcommand*\breakbeforecjkoparen[1]{%
  \ifnum #1>"3007 \ifnum #1<"301C
      \ifodd #1\else \discretionaryorglue \fi
  \fi\fi
  \ifnum #1>"FF00 \ifnum #1<"FFEF
    \ifnum #1="FF08 \discretionaryorglue
    \else\ifnum #1="FF1C \discretionaryorglue
    \else\ifnum #1="FF3B \discretionaryorglue
    \else\ifnum #1="FF5B \discretionaryorglue
    \fi\fi\fi\fi
  \fi\fi
}
\newcommand*\insertjapaneseglue[1]{%
  \count@=#1
  \ifnum \count@>"309F \advance\count@-"60 \fi
  \ifnum\count@="3041 \else
  \ifnum\count@="3043 \else
  \ifnum\count@="3045 \else
  \ifnum\count@="3047 \else
  \ifnum\count@="3049 \else
  \ifnum\count@="3063 \else
  \ifnum\count@="3083 \else
  \ifnum\count@="3085 \else
  \ifnum\count@="3087 \else
  \ifnum\count@="308E \else
  \ifnum\count@>"3094 \else
    \discretionaryorglue
  \fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi
}
\newcommand*\hangulspacefactor[1]{%
  \ifnum #1>13311
    \ifnum #1<64255 \spacefactor=\Hangul@spacefactor \else% hangul, hanja
    \ifnum #1=65288 \spacefactor=998  \else% （
    \ifnum #1=65308 \spacefactor=998  \else% ＜
    \ifnum #1=65339 \spacefactor=998  \else% ［
    \ifnum #1=65371 \spacefactor=998       % ｛
    \fi\fi\fi\fi\fi\else
  \ifnum #1>12295
  \ifnum #1<12316                      % 〈〉《》「」 etc
    \ifodd #1\else \spacefactor=998 \fi% 〈《「『【 etc
  \fi\fi\fi
}
\DeclareRobustCommand*\BreakBeforeAsciiOParen[1]{%
  \ifnum#1=8220 %“
        \spacefactor=998
  \else\ifnum#1=8216
        \spacefactor=998
  \fi\fi
  \expandafter\BreakBeforeAsciiOParen@
}
\def\BreakBeforeAsciiOParen@{%
  \futurelet\IsNextAsciiOParen\breakbeforeasciioparen
}
\def\breakbeforeasciioparen{%
  \ifx (\IsNextAsciiOParen \hskip\z@ \fi
}
%%% BANGJEOM emphasis
\let\dhucs@emph\@gobble
\newdimen\dhucs@emph@raise
\newcommand*\dotemph[1]{\begingroup
  \settoheight{\dhucs@emph@raise}{#1}%
  \addtolength{\dhucs@emph@raise}{-.4em}%
  \let\dhucs@emph\dot@emph
  #1\endgroup}
\newcommand*\dot@emph[1]{\leavevmode
  \settowidth{\dimen@}{#1}%
  \llap{\raise\dhucs@emph@raise
    \hb@xt@\dimen@{\normalfont\bfseries\hss˙\hss}}%
}
%%%%%
%% Autojosa and hangul.
\def\josa@buf@del{\gdef\josa@hyper@link@toklist{^^J}}\josa@buf@del
\newcount\@josa
\def\jong{\josa@buf@del\global\@josa\z@}
\def\rieul{\josa@buf@del\global\@josa\@ne}
\def\jung{\josa@buf@del\global\@josa\tw@}
\if@nojosa
  \let\josa@hyper@link\relax
\else %%% autojosa for ascii chars begins here
\AtBeginDocument{%
  % redefine ref/pageref for autojosa
  \let\@setref@dhucs@orig\@setref
  \def\@setref#1#2#3{\@setref@dhucs@orig{#1}{#2}{#3}%
    \ifx#1\relax\else
      \gdef\josa@hyper@link@toklist{\expandafter#2#1}%
    \fi}%
  % redefine cite for autojosa: base only or with hyperref.sty
  \let\@cite@ofmt@dhucs@orig\@cite@ofmt
  \def\@cite@ofmt#1{\@cite@ofmt@dhucs@orig{#1}%
    \bgroup\let\unihangulchar\dh@unichar@null@
    \let\dhucsPrerenderUnicode\dh@unichar@null@
    \let\unichar\dh@unichar@null@
    \let\BreakBeforeAsciiOParen\@gobble
    \def\hyper@@link[##1]##2##3##4{##4}%
    \xdef\josa@hyper@link@toklist{#1}\egroup}%
  % redefine cite for autojosa: with cite.sty
  \@ifpackageloaded{cite}{%
    \let\citeform@dhucs@orig\citeform
    \def\citeform#1{\citeform@dhucs@orig{#1}%
      \bgroup\let\unihangulchar\dh@unichar@null@
      \let\dhucsPrerenderUnicode\dh@unichar@null@
      \let\unichar\dh@unichar@null@
      \let\BreakBeforeAsciiOParen\@gobble
      \def\hyper@@link[##1]##2##3##4{##4}%
      \xdef\josa@hyper@link@toklist{#1}\egroup}%
  }{}%
  % redefine cite for autojosa: with natbib.sty (NOT a full support yet)
  \@ifpackageloaded{natbib}{%
    \expandafter\def\expandafter\hyper@natlinkend\expandafter{\hyper@natlinkend
      \bgroup\def\protect##1##2{^^J}% FIXME: how to do about \protect
      \ifnum\NAT@ctype=1
        \xdef\josa@hyper@link@toklist{\expandafter\@firstofone\NAT@nm}%
      \else
        \ifNAT@numbers\xdef\josa@hyper@link@toklist{\NAT@num}\else
          \xdef\josa@hyper@link@toklist{\NAT@date}\fi
      \fi\egroup}%
  }{}%
}
\newcommand*\dh@unichar@null@[1]{^^J}
\def\josa@hyper@link{%
  \begingroup
  \let\unihangulchar\dh@unichar@null@
  \let\dhucsPrerenderUnicode\dh@unichar@null@
  \let\unichar\dh@unichar@null@
  \let\BreakBeforeAsciiOParen\@gobble
  \edef\dh@josa@temp{\josa@hyper@link@toklist}%
  \toks@{}%
  \expandafter\josa@hyper@link@\dh@josa@temp\@nil
  \expandafter\josa@hyper@link@@\the\toks@\empty\empty\empty\empty\@nil
  \endgroup}
\def\josa@hyper@link@#1{%
  \ifx#1\@nil\let\next\relax
  \else \let\next\josa@hyper@link@
    \if\noexpand#1\relax\else
    \ifx)#1\else
      \edef\act{\noexpand\toks@{#1\the\toks@}}\act % by little tree
    \fi\fi
  \fi\next}
\def\josa@hyper@link@@#1#2#3#4\@nil{%
  \ifx#1^^J\else
    \ifx 1#1\rieul\else
    \ifx 3#1\jong\else
    \ifx 6#1\jong\else
    \ifx 7#1\rieul\else
    \ifx 8#1\rieul\else
    \ifx 0#1\jong\else
    \ifx l#1\rieul\else
    \ifx m#1\jong\else
    \ifx n#1\jong\else
    \ifx L#1\rieul\else
    \ifx M#1\jong\else
    \ifx N#1\jong\else
      \jung
    \fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi 
    \ifx n#2\ifx g#1\jong\fi\fi%skating
    \ifx a#2\ifx p#1\jong\fi\fi%cap
    \ifx u#2\ifx p#1\jong\fi\fi%cup
    \ifx a#2\ifx t#1\jong\fi\fi%cat
    \ifx e#2\ifx t#1\jong\fi\fi%Hamlet
    \ifx i#2\ifx t#1\jong\fi\fi%summit
    \ifx o#2\ifx t#1\jong\fi\fi%not
    \ifx u#2\ifx t#1\jong\fi\fi%nut
    \ifx o#2\ifx k#1\jong\fi\fi%book
    \ifx i#2\ifx c#1\jong\fi\fi%picnic
    \ifx l#2\ifx e#1\rieul\fi\fi%apple
    \ifx i#3\ifx m#2\ifx e#1\jong\fi\fi\fi%time
    \ifx i#3\ifx n#2\ifx e#1\jong\fi\fi\fi%mine
    \ifx a#3\ifx c#2\ifx k#1\jong\fi\fi\fi%back
    \ifx i#3\ifx c#2\ifx k#1\jong\fi\fi\fi%pick
    \ifx o#3\ifx a#2\ifx t#1\jung\fi\fi\fi%boat
    \ifx T#3\ifx e#2\ifx X#1\jong\fi\fi\fi%TeX
  \fi}
\fi %%% autojosa for ascii chars ends here
\def\josa@hanja@hangul#1{\begingroup
  \count@=\z@
  \openin1=#1\relax \josa@hanja \closein1
  \endgroup}
\def\josa@hanja{\read1 to \temp
  \ifnum\count@=\@josa
    \global\@josa\temp \let\next\relax
  \else
    \advance\count@\@ne \let\next\josa@hanja
  \fi \next}
\def\make@josa#1#2{%
  \josa@hyper@link
  \ifnum\@josa>19967 \ifnum\@josa<40870 %%% CJK UNIFIED IDEOGRAPHS
    \advance\@josa-19968 % "4E00
    \josa@hanja@hangul{hanja_hg.tab}\fi\fi
  \ifnum\@josa>13311 \ifnum\@josa<19894 %%% CJK UNIFIED IDEOGRAPHS EXT. A
    \advance\@josa-13312 % "3400
    \josa@hanja@hangul{hjexa_hg.tab}\fi\fi
  \ifnum\@josa>63743 \ifnum\@josa<64046 %%% CJK COMPATIBILITY IDEOGRAPHS
    \advance\@josa-63744 % "F900
    \josa@hanja@hangul{hjcom_hg.tab}\fi\fi
  \ifnum\@josa>44031 \ifnum\@josa<55204 %%% hangul syllables
    \advance\@josa-44032 % "AC00
    \count@=\@josa \divide\count@28 \multiply\count@28
    \advance\@josa-\count@ \advance\@josa4519 % "11A7
    \ifnum\@josa=4519 \jung
    \else\ifnum\@josa=4527 \rieul % "11AF
    \else \jong \fi\fi \fi\fi
  \ifnum\@josa>12592 \ifnum\@josa<12623 %%% ㄱㄴㄷㄹ
    \ifnum\@josa=12601 \rieul
    \else\jong\fi \fi\fi
  \ifnum\@josa>12895 \ifnum\@josa<12924 \advance\@josa-96 \fi\fi
  \ifnum\@josa>12799 \ifnum\@josa<12814 %%% ㉠ or ㈀
    \ifnum\@josa=12803 \rieul
    \else\jong\fi \fi\fi
  \ifnum\@josa>12813 \ifnum\@josa<12829 %%% ㉮ or ㈎
    \jung \fi\fi
  \ifnum\@josa>9311 \ifnum\@josa<9372 %%% ① or ⑴
    \advance\@josa\m@ne \num@josa{\@josa}\fi\fi
  \ifnum\@josa>9423 \ifnum\@josa<9450 \advance\@josa-26 \fi\fi
  \ifnum\@josa>9397 \ifnum\@josa<9424 \advance\@josa-26 \fi\fi
  \ifnum\@josa>9371 \ifnum\@josa<9398 %%% ⓐ or ⒜
    \ifnum\@josa=9383 \rieul\else % l
    \ifnum\@josa=9384 \jong\else  % m
    \ifnum\@josa=9385 \jong\else  % n
    \jung\fi\fi\fi \fi\fi
  \ifnum\@josa>8543 \ifnum\@josa<8556 % ⅰⅱⅲ
    \advance\@josa-3 \num@josa{\@josa}\fi\fi
  \ifnum\@josa>8559 \ifnum\@josa<8572 % ⅠⅡⅢ
    \advance\@josa\@ne \num@josa{\@josa}\fi\fi
  \ifnum\@josa=\@ne \ifx#1\empty #1\else#2\fi% rieul
    \else \ifnum\@josa=\tw@ #1% jung
    \else #2% jong
    \fi\fi}
\def\num@josa#1{\bgroup\count@#1%
  \ifnum\count@<\z@ \count@-\count@ \fi\count2\count@
  \divide\count2 10 \multiply\count2 10 \advance\count@-\count2
  \ifcase\count@\jong\or\rieul\or\jung\or\jong\or\jung\or
    \jung\or\jong\or\rieul\or\rieul\or\jung\fi\egroup}
\def\error@josa{\PackageError{dhucs}{Undefined Control Sequence}{}}
\def\^^ea#1#2{%
  \ifx#1^^b0\ifx#2^^80\make@josa{가}{이}\else\error@josa\fi% 가
  \else\ifx#1^^b3\ifx#2^^bc\make@josa{와}{과}\else\error@josa\fi% 과
  \else\error@josa\fi\fi}
\def\^^eb#1#2{%
  \ifx#1^^8a\ifx#2^^94\make@josa{는}{은}\else\error@josa\fi% 는
  \else\ifx#1^^9d\ifx#2^^bc\make@josa{라}{이라}\else\error@josa\fi% 라
  \else\ifx#1^^a1\ifx#2^^9c\make@josa{}{으}로\else\error@josa\fi% 로
  \else\ifx#1^^a5\ifx#2^^bc\make@josa{를}{을}\else\error@josa\fi% 를
  \else\error@josa\fi\fi\fi\fi}
\def\^^ec#1#2{%
  \let\do@i@ira\relax
  \ifx#1^^99\ifx#2^^80\make@josa{와}{과}\else\error@josa\fi% 와
  \else\ifx#1^^9c\ifx#2^^bc\make@josa{}{으}\else\error@josa\fi% 으
  \else\ifx#1^^9d\ifx#2^^80\make@josa{는}{은}% 은
            \else\ifx#2^^84\make@josa{를}{을}% 을
            \else\ifx#2^^b4\let\do@i@ira\josa@I@IRA% 이?
            \else\error@josa\fi\fi\fi
  \else\error@josa\fi\fi\fi\do@i@ira}
\def\josa@I@IRA{\futurelet\josa@next\josa@I@IRA@}
\def\josa@I@IRA@{\ifx^^eb\josa@next\make@josa\relax{이}% 이라
  \else\make@josa{가}{이}% 이
  \fi}
\def\jaso#1{\@jaso{\@nameuse{c@#1}}}
\def\@jaso#1{\ifcase#1\or ㄱ\or ㄴ\or ㄷ\or ㄹ\or ㅁ\or ㅂ\or ㅅ\or ㅇ\or ㅈ\or
  ㅊ\or ㅋ\or ㅌ\or ㅍ\or ㅎ\else\@ctrerr\fi}
\def\gana#1{\@gana{\@nameuse{c@#1}}}
\def\@gana#1{\ifcase#1\or 가\or 나\or 다\or 라\or 마\or 바\or 사\or 아\or 자\or
  차\or 카\or 타\or 파\or 하\else\@ctrerr\fi}
\def\ojaso#1{\@ojaso{\@nameuse{c@#1}}}
\def\@ojaso#1{\ifcase#1\or ㉠\or ㉡\or ㉢\or ㉣\or ㉤\or ㉥\or ㉦\or ㉧\or ㉨\or
  ㉩\or ㉪\or ㉫\or ㉬\or ㉭\else\@ctrerr\fi}
\def\ogana#1{\@ogana{\@nameuse{c@#1}}}
\def\@ogana#1{\ifcase#1\or ㉮\or ㉯\or ㉰\or ㉱\or ㉲\or ㉳\or ㉴\or ㉵\or ㉶\or
  ㉷\or ㉸\or ㉹\or ㉺\or ㉻\else\@ctrerr\fi}
\def\pjaso#1{\@pjaso{\@nameuse{c@#1}}}
\def\@pjaso#1{\ifcase#1\or ㈀\or ㈁\or ㈂\or ㈃\or ㈄\or ㈅\or ㈆\or ㈇\or ㈈\or
  ㈉\or ㈊\or ㈋\or ㈌\or ㈍\else\@ctrerr\fi}
\def\pgana#1{\@pgana{\@nameuse{c@#1}}}
\def\@pgana#1{\ifcase#1\or ㈎\or ㈏\or ㈐\or ㈑\or ㈒\or ㈓\or ㈔\or ㈕\or ㈖\or
  ㈗\or ㈘\or ㈙\or ㈚\or ㈛\else\@ctrerr\fi}
\def\onum#1{\@onum{\@nameuse{c@#1}}}
\def\@onum#1{\ifcase#1\or ①\or ②\or ③\or ④\or ⑤\or ⑥\or ⑦\or ⑧\or ⑨\or
  ⑩\or ⑪\or ⑫\or ⑬\or ⑭\or ⑮\else\@ctrerr\fi}
\def\pnum#1{\@pnum{\@nameuse{c@#1}}}
\def\@pnum#1{\ifcase#1\or ⑴\or ⑵\or ⑶\or ⑷\or ⑸\or ⑹\or ⑺\or ⑻\or ⑼\or
  ⑽\or ⑾\or ⑿\or ⒀\or ⒁\or ⒂\else\@ctrerr\fi}
\def\oeng#1{\@oeng{\@nameuse{c@#1}}}
\def\@oeng#1{\ifcase#1\or ⓐ\or ⓑ\or ⓒ\or ⓓ\or ⓔ\or ⓕ\or ⓖ\or ⓗ\or ⓘ\or
  ⓙ\or ⓚ\or ⓛ\or ⓜ\or ⓝ\or ⓞ\or ⓟ\or ⓠ\or ⓡ\or ⓢ\or ⓣ\or
  ⓤ\or ⓥ\or ⓦ\or ⓧ\or ⓨ\or ⓩ\else\@ctrerr\fi}
\def\peng#1{\@peng{\@nameuse{c@#1}}}
\def\@peng#1{\ifcase#1\or ⒜\or ⒝\or ⒞\or ⒟\or ⒠\or ⒡\or ⒢\or ⒣\or ⒤\or
  ⒥\or ⒦\or ⒧\or ⒨\or ⒩\or ⒪\or ⒫\or ⒬\or ⒭\or ⒮\or ⒯\or
  ⒰\or ⒱\or ⒲\or ⒳\or ⒴\or ⒵\else\@ctrerr\fi}
\def\hnum#1{\@hnum{\@nameuse{c@#1}}}
\def\@hnum#1{\ifcase#1\or 하나\or 둘\or 셋\or 넷\or 다섯\or 여섯\or 일곱\or
  여덟\or 아홉\or 열\or 열하나\or 열둘\or 열셋\or 열넷\or 열다섯\or 열여섯\or
  열일곱\or 열여덟\or 열아홉\or 스물\or 스물하나\or 스물둘\or 스물셋\or
  스물넷\else\@ctrerr\fi}
\def\Hnum#1{\@Hnum{\@nameuse{c@#1}}}
\def\@Hnum#1{\ifcase#1\or 첫\or 둘\or 셋\or 넷\or 다섯\or 여섯\or 일곱\or
  여덟\or 아홉\or 열\or 열한\or 열두\or 열셋\or 열넷\or 열다섯\or 열여섯\or
  열일곱\or 열여덟\or 열아홉\or 스무\or 스물한\or 스물두\or 스물셋\or
  스물넷\else\@ctrerr\fi 째}
\def\hroman#1{\@hroman{\@nameuse{c@#1}}}
\def\@hroman#1{\ifcase#1\or ⅰ\or ⅱ\or ⅲ\or
  ⅳ\or ⅴ\or ⅵ\or ⅶ\or ⅷ\or ⅸ\or ⅹ\or ⅺ\or ⅻ\else\@ctrerr\fi}
\def\hRoman#1{\@hRoman{\@nameuse{c@#1}}}
\def\@hRoman#1{\ifcase#1\or Ⅰ\or Ⅱ\or Ⅲ\or
  Ⅳ\or Ⅴ\or Ⅵ\or Ⅶ\or Ⅷ\or Ⅸ\or Ⅹ\or Ⅺ\or Ⅻ\else\@ctrerr\fi}

%% redefining MakeUppercase/MakeLowercase.
%% from latex.ltx
\DeclareRobustCommand{\MakeUppercase}[1]{{%
      \PrerenderUnicode{#1}%
      \def\i{I}\def\j{J}%
      \def\reserved@a##1##2{\let##1##2\reserved@a}%
      \expandafter\reserved@a\@uclclist\reserved@b{\reserved@b\@gobble}%
      \protected@edef\reserved@a{\uppercase{#1}}%
      \reserved@a
   }}
\DeclareRobustCommand{\MakeLowercase}[1]{{%
      \PrerenderUnicode{#1}%
      \def\reserved@a##1##2{\let##2##1\reserved@a}%
      \expandafter\reserved@a\@uclclist\reserved@b{\reserved@b\@gobble}%
      \protected@edef\reserved@a{\lowercase{#1}}%
      \reserved@a
   }}
\protected@edef\MakeUppercase#1{\MakeUppercase{#1}}
\protected@edef\MakeLowercase#1{\MakeLowercase{#1}}
%% utf-8 undeferr processing.
%% write \PrerenderUnicode to .aux and \jobname.pru external file.
%% undeferr letters in .idx is to be processed by makeindex-dhucs.pl.
\newtoks\dh@prerender@toks
\dh@prerender@toks={}
\DeclareRobustCommand\dhucsPrerenderUnicode[1]{%
  \dhucsPrerenderUnicode@#1\dh@prerender@nil}
\def\dhucsPrerenderUnicode@#1#2#3\dh@prerender@nil{% <"FFFF only. FIXME!
  \ifnum`#1<"E0
    \ifx \empty#3\empty
      \expandafter\ifx
        \csname DHPRERENDER-\number`#1-\number`#2\endcsname\relax
          \dhucsPrerenderUnicode@@{#1#2}%
        \expandafter\gdef
          \csname DHPRERENDER-\number`#1-\number`#2\endcsname{}%
      \fi
    \else
      \typeout{***** Rerun or insert \string\PrerenderUnicode{??}
        into preamble. *****}%
    \fi
  \else
    \ifx \empty#3\empty
      \typeout{***** Rerun or insert \string\PrerenderUnicode{??}
        into preamble. *****}%
    \else
      \expandafter\ifx
        \csname DHPRERENDER-\number`#1-\number`#2-\number`#3\endcsname\relax
          \dhucsPrerenderUnicode@@{#1#2#3}%
        \expandafter\gdef
          \csname DHPRERENDER-\number`#1-\number`#2-\number`#3\endcsname{}%
      \fi
    \fi
  \fi}
\def\dhucsPrerenderUnicode@@#1{%
    \PrerenderUnicode{#1}\global\dh@prerender@toks
    \expandafter{\the\dh@prerender@toks^^J\dhucsPrerenderUnicode{#1}}}
\AtBeginDocument{%
  \immediate\write\@mainaux{\the\dh@prerender@toks}%
  \def\dhucsPrerenderUnicode@@#1{\PrerenderUnicode{#1}%
    \toks@{\dhucsPrerenderUnicode{#1}}\immediate
    \write\@mainaux{\the\toks@}}}
\def\utf@viii@undeferr#1#2#3#4#5#6{%
  \ifx\@gobble#1\else ??\dhucsPrerenderUnicode{#1}\fi}
\AtEndDocument{%
  \if@filesw\else\typeout{^^JPlease insert into preamble, if needed:}\fi
  \let\dhucsPrerenderUnicode\@gobble
} 
%%% TODO: more fundamental solution to PrerenderUnicode problem?
\AtBeginDocument{%
  \let\@lbibitem@original\@lbibitem
  \def\@lbibitem[#1]#2{%
    \toks@{\PrerenderUnicode{#1}}%
    \immediate\write\@mainaux{\the\toks@}%
    \PrerenderUnicode{#1}%
    \@lbibitem@original[#1]{#2}%
  }%
  \@ifpackageloaded{dhucs-ucshyper}{\typeout
    {* hyperref v6.75 or up supports PDF bookmarks on utf-8 input *}}{%
    \ifx\HyPsd@DecimalToOctal\undefined\else
      \let\dhucs@old@pdfstringdef\pdfstringdef
      \def\pdfstringdef#1#2{\PrerenderUnicode{#2}%
        \dhucs@old@pdfstringdef{#1}{#2}}\fi
  }%
}

%% load standard Hangul Document Format,
%% if hangul option is given.
\if@hangul
\InputIfFileExists{ucs-hangul.tex}{}{%
       \PackageWarning{dhucs}{ucs-hangul.tex doesn't exist!}{}}%
\fi

\tracinglostchars=2
\endinput

% CHANGE LOG
%
% 2004/12/30.
%    dhhangul-ucs-test/2004/12/30.
% 2004/12/31.
%    dhhangul-ucs-test/2004/12/31.
% 2005/01/01.
%    renamed to dhucs.sty.
%    pre-release version.
% 2005/01/03.
%    add hanja option for ucs-hangul.tex
% 2005/01/03.
%    co-author info changed.
%    load package utf8.def when utf8x cannot be found.
%    character area rearranged.
%    nonfrench -- spacefactor of Hangul Chars changed to 1001.
% 2005/01/05.
%    \unichar definition changed.
%    write \PrerenderUnicode to .aux file.
% 2005/01/07.
%    hack original \utf@viii@undeferr in utf8x.def
%    drop Prerenders.def inclusion, instead, \jobname.pru
% ver 1.1 (20050107)
%    \josa@hyper@link definition altered.
% ver 1.2beta (20050114)
%    autojosa to all Hanja characters.
% ver 2.0beta (20050117)
%    \josa@lastt@kens definition altered.
% ver 2.0beta2 (20050119)
%    \utf...undeferr redefined.
%    \unichar areas rearranged.
% ver 2.0beta3 (20050120)
%    \utf...undeferr redefined after dhucs-1.40
% ver 2.0beta4 (20050121)
%    \utf...endeferr rederined after dhucs-1.41
% ver 2.0beta5 (20050122)
%    \unichar definition changed after dhucs-1.5
% ver 2.0 (20050214)
%    \MakeUppercase, \MakeLowercase redefined.
% ver 2.1 (20050424)
%    redefine \normalfont
% ver 2.2 (20050426)
%    hangul BANGJEOM
% ver 2.3 (20050428)
%    redefine \LUC@@empty
%    fake-tfms can be removed.
% ver 2.4 (20050628)
%    'allow break before hangul chars' implemented by Dohyun Kim.
% ver 2.5 (20050711)
%    'allow break before opening parenthesis' implemented. (DH)
% ver 2.6 (20050824)
%    major improvements of unihangulchar algorithm
%    default latin font encoding changed to OT1 (cmr)
%    font selection scheme rearranged
%    and other alterations.
% ver 2.7 (20060327)
%    dhucs-cmap.sty : enables pdf search and extraction along with pdftex
% ver 2.7.1 (20060413)
%    hypernation of latin words inside parentheses
% ver 2.7.2 (20060417)
%    improve autojosa: even beamer doesn't need [nojosa]
%    use .aux instead of .pru
% ver 3.0.0 (20060425)
%    autojosa does not depend on hyperref package
%    autojosa begins to support natbib package
% ver 3.0.1 (20060615)
%    no \immediate when writing \dhucs@prerender@toks to .aux
% ver 3.0.2 (20060615)
%    fix a bug (in case of beamer) introduced at previous commit
% ver 3.0.3 (20060907)
%    support hyperref.sty > v6.75 (we may now drop dhucs-ucshyper)
%
% end of file `dhucs.sty`.
