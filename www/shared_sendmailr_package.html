<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>sendmailR 팩키지 소개</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>





</head>

<body>
<h1>sendmailR 팩키지 소개</h1>

<p>이메일을 자동으로 보내는 방법은 R보다 python같은 다른 종류의 language들이 더 발달되어있다. 하지만 여기서 이 팩키지를 소개하고 싶은 이유는 R에서 상당히 시간이 오래걸리는 작업을 할때나 R을 자동화 시켰을 경우 그에 따른 작업진행 현황이나 결과를 일일이 확인하는게 불편할때가있다. 이럴때 유용하게 필자가 사용한 팩키지가 sendmailR이다. 이 팩키지는 R에서 자동으로 이메일을 생성하여 지정된 수신자에게 원하는 메시지와 첨부파일등을 보내게 해준다.</p>

<p>우선 다음과 같이 팩키지를 설치한후 smtp 서버를 지정해준다. 여기서 사용한 smtp서버는 gmail 서버중 authentication이 필요없는 서버이다. 보통 구글링을 해서 찾아보면 gmail의 smtp서버는 smtp.gmail.com 을 사용하라고 알려주겠지만 sendmailR은 아직 authentication을 사용하여 이메일을 생성하는 기능이 없기때문에 여기서는 ASPMX.L.GOOGLE.COM 을 사용하겠다. 여기서 주의할점은 서버에서 보내지는 메일이라 수신자의 이메일 서비스에서 spam으로 분류될수도있고 block이되어 전달이 되지 않을 가능성도있다. 하지만 같은 gmail 끼리는 spam처리는 될지언정 block은 되지않는다. </p>

<p>gmail이 아닌 다른 메일 서비스를 사용할경우 그 서비스에 해당되는 smtp서버를 찾아 지정해준다.</p>

<pre><code>install.packages(&quot;sendmailR&quot;,repos=&quot;http://cran.r-project.org&quot;)
library(sendmailR) 

mailControl&lt;-list(smtpServer=&quot;ASPMX.L.GOOGLE.COM&quot;)
</code></pre>

<p>물론 직장에서 사용한다면 사내 메일을 운영하는 smtp서버로 지정한다. 보통 이런 메일시스템들은 회사 네트워크와 synchronise되있기 때문에 회사 네트워크로 로그인한 상태에서 사용한다면 authentication이 필요없을 가능성이 높다. 그러다면 spam으로 분류되거나 block되는 일도 없을것이다.</p>

<p>그리고 해외에서 활동하는경우 한글로 이메일을 발송할때 깨지는 경우가 있으므로 locale을 한국으로 바꾸어준다.</p>

<pre><code>Sys.setlocale(&quot;LC_CTYPE&quot;,&quot;Korean_Korea&quot;)
</code></pre>

<p>발신인을 아래와같이 정해준다. </p>

<pre><code>from&lt;-sprintf(&quot;&lt;....@gmail.com&gt;&quot;,&quot;...발신자 이름 (optional)...&quot;)
</code></pre>

<p>이메일 제목정하기는 아래와같이한다.</p>

<pre><code>subject &lt;- &quot;Hello + 한국어&quot;
</code></pre>

<p>아래는 보내는 이메일 내용이다. paste()를 사용한이유는 줄을 맞추기 위함이다.</p>

<pre><code>body &lt;- paste(&quot;Hi&quot;,
              &quot;Testing sendmailR&quot;,
              &quot;한국어 시험&quot;,
              sep=&quot;\n&quot;)
</code></pre>

<h2>1. 한명에게 보내기</h2>

<p>수신인이 한명일경우 아래와 같이 정해준다.</p>

<pre><code>to&lt;-sprintf(&quot;&lt;....@gmail.com&gt;&quot;)
</code></pre>

<p>그리고 아래와같이 실행을 하면 메일이 보내어 진다.</p>

<pre><code>sendmail(from=from,to=to,subject=subject,msg=body,control=mailControl)
</code></pre>

<h2>2. 수신인이 한명이상 일때</h2>

<p>수신인이 한명 이상일경우 아래와 같이 정해준다.</p>

<pre><code>to&lt;-sprintf(c(&quot;&lt;....@gmail.com&gt;&quot;,&quot;&lt;...@gmail.com&gt;&quot;))
</code></pre>

<p>그리고 아래와같이 실행을 하면 수신인 모두에게 메일이 보내어 진다.</p>

<pre><code>sapply(to,function(x)sendmail(from=from,to=x,subject=subject,msg=body,control=mailControl))
</code></pre>

<h2>3. 첨부 파일이 있을때</h2>

<p>아래의 예는 첨부파일이 2개일때이다.</p>

<p>첫번째 첨부파일의 저장된 위치와 이름을 지정한다.</p>

<pre><code>ATT1&lt;-&quot;C:/.../scdum-1.PNG&quot;
</code></pre>

<p>메일에 첨부할수있게 mime_part로 전환한다.</p>

<pre><code>attachmentObject1&lt;-mime_part(ATT1,name=&quot;scdum-1.PNG&quot;)
</code></pre>

<p>위와 같은 방법으로 두번째 첨부파일을 만든다.</p>

<pre><code>ATT2&lt;-&quot;C:/.../scdum-2.csv&quot;
attachmentObject2&lt;-mime_part(ATT2,name=&quot;scdum-2.csv&quot;)
</code></pre>

<p>메일의 내용문과 첨부파일을 리스트형식으로 만든다.</p>

<pre><code>bodyWithAtt &lt;- list(body,attachmentObject1,attachmentObject2)
</code></pre>

<p>보내는 방법은 위에서 설명한 방법과 동일하다. msg=bodyWithAtt로 지정해준다.</p>

<pre><code>sapply(to,function(x)sendmail(from=from,to=x,subject=subject,msg=bodyWithAtt,control=mailControl))
</code></pre>

<h2>4. 정리된 예</h2>

<pre><code>library(sendmailR) 
mailControl&lt;-list(smtpServer=&quot;ASPMX.L.GOOGLE.COM&quot;)

Sys.setlocale(&quot;LC_CTYPE&quot;,&quot;Korean_Korea&quot;)

from&lt;-sprintf(&quot;&lt;abc@gmail.com&gt;&quot;,&quot;홍길동&quot;)
to&lt;-sprintf(c(&quot;&lt;abc1@gmail.com&gt;&quot;,&quot;&lt;abc2@gmail.com&gt;&quot;))

subject &lt;- &quot;안녕하세요&quot;
body &lt;- paste(&quot;메일 테스트&quot;,&quot;&quot;,
              &quot;123&quot;,&quot;&quot;,
              Sys.time(),&quot;&quot;,
              &quot;홍길동&quot;,
              sep=&quot;\n&quot;)

sapply(to,function(x)sendmail(from=from,to=x,subject=subject,msg=body,control=mailControl))
</code></pre>

</body>

</html>

