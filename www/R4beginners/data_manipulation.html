<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>데이터 조작 실무예제</title>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>

<!-- MathJax scripts -->
<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}
</style>



</head>

<body>
<h2>데이터 조작 실무예제</h2>

<p>이전 섹션까지 R에서 다루는 다양한 종류의 데이터형들에 대해서
알아보았습니다. 통계분석 실무에서는 분석자가 보통 얻게 되는 데이터는
분석에 사용되는 통계모형의 적용요건에 부합하는 경우는 드물기 때문에
분석자 스스로가 이러한 데이터를 형성하는 것은 필요한 기술중에 하나라고
할 수 있습니다.</p>

<p>서울종합과학대학원 사회학과의 신종화 교수님께서 본 섹션을 위해서
dart8.xls 이라는 데이터를 제공해 주셨습니다. 실무에서 접할 수 있는
다양한 점들을 부각하고자, 신종화 교수님으로부터 전달받은 데이터에는 그
어떠한 수정도 이루어지지 않았습니다. 분석을 위한 데이터들을 만들기
위해서 R은 이 데이터를 어떻게 받아들이고 처리했는지 상세히 기록하고자
하였습니다.</p>

<h3>데이터셋에 대한 간단한 설명:</h3>

<p>제공된 데이터셋은 8개의 여행사들의 “광고선전비”, “교육훈련비”,
“매출액”을 2000년 12월부터 2011년 9월까지 월별로 기록한 내용이 dart8.xls
이라는 엑셀파일에 저장되어 있습니다. 이 자료는 여행사별 자료는 개별
워크시트에 따로 저장이 되어 있으며, 변수명은 한글이 사용되어 있습니다.</p>

<p>본 데이터는 <a href="dart8.xls">여기 다운로드 링크</a>를 눌러 다운받을 수 있습니다.</p>

<h3>엑셀 데이터 불러오기:</h3>

<p>R을 이용하여 분석을 준비하고자 한다면 데이터를 R로 불러오는 것이 그
첫번째 작업일 것입니다. 이 데이터는 한 개의 엑셀파일에 있는 8개의
워크시트에 분산되어 있기 때문에 먼저 하나로 모두 모아야 합니다. 다행이도
각 워크시트에 정리되어 있는 데이터는 동일한 개수의 변수들이 있고,
변수들의 순서도 일치합니다. 이를 수행하기 위해서 gdata이라는 패키지를
먼저 불러옵니다.</p>

<pre><code class="r">library(gdata)
</code></pre>

<p>먼저 엑셀 파일에 제대로 읽힐 수 있는가를 확인하기 위해서 하나의
워크시트를 테스트용으로 읽어봅니다.</p>

<pre><code class="r">tmp &lt;- gdata:::read.xls(xls = &quot;dart8.xls&quot;, sheet = 1)
</code></pre>

<p>잘 읽혀옵니다.  그런데, 일부 사용자는 아래와 같은 메시지를 볼 지도
모릅니다. </p>

<pre><code> Wide character in print at
 /usr/lib/R/site-library/gdata/perl/xls2csv.pl line 211. 
Wide character in print at /usr/lib/R/site-library/gdata/perl/xls2csv.pl line 270.
</code></pre>

<p>여기에서  “wide character in print”라는 메시지는 R의 버그가 아니라,
엑셀데이터를 파싱하는데 사용되는 Perl이라는 언어가 데이터내에
유니코드문자가 있을때 발생시키는 메시지 입니다. 즉, 한글을 표현하는
멀티바이트 인코딩 때문에 발생하는 것입니다. 이러한 메시지가
나왔을지라도 실제로 데이터를 홖인해보시면 데이터에는 아무런 
손상이 없음을 알 수 있습니다.</p>

<h3>XLConnect 패키지의 활용:</h3>

<p>그런데, 이러한 메시지를 보게되면 웬지 모르게 꺼림칙합니다. 아니면
원본데이터의 변수명 자체를 없애거나 변경하거나 해야할 것입니다. 그러나,
데이터클리닝시에는 원본 데이터에는 절대로 손을 대어서는 안됩니다. 모든
클리닝 작업은 기록화 되어 추후에도 자동적으로 처리가 될 수 있도록
해야합니다. 이것은 추후에 제3자에 의한 재생산연구(reproducible research)
가 가능하도록 하여 분석의 객관성을 유지할 수 있습니다.</p>

<p>따라서, XLConnect 라는 운영체제에 관계없이 사용될 수 있는 또 다른 종류의
패키지를 아래와 같이 불러왔습니다.</p>

<pre><code class="r">library(XLConnect)
</code></pre>

<p>그리고 아래와 같이 데이터를 읽어왔더니, 어떠한 메시지 없이 잘
수행되었음을 볼 수 있었습니다.</p>

<pre><code class="r">library(XLConnect)
tmp &lt;- readWorksheetFromFile(file = &quot;dart8.xls&quot;, sheet = 1)
</code></pre>

<p>이 패키지를 설치할 때 어떤 분은 아래와 같은 메시지를 볼 수도
있습니다. </p>

<pre><code>Error: package ‘rJava’ was built before R 3.0.0: please re-install it
</code></pre>

<p>이 경우에는 아래와 같은 방법으로 해결이 가능합니다. </p>

<pre><code>sudo apt-get install openjdk-7-*
sudo R CMD javareconf
</code></pre>

<h3>데이터의 처음과 마지막 부분을 확인:</h3>

<p>정말로 잘 수행되었는지를 확인하기 위해서 데이터의 처음과 마지막을 살펴볼
수 있는 head()와 tail()함수를 이용해 봅니다.</p>

<pre><code class="r">head(tmp)
</code></pre>

<pre><code>##   구....분 광고선전비 교육훈련비    매출액
## 1     2000  161702806   18002000 5.616e+09
## 2     2001   80485618   28146500 7.189e+09
## 3     2001  170827271   12965900 7.949e+09
## 4     2001   65667863   26468000 1.151e+10
## 5     2001   27804868   16838062 7.799e+09
## 6     2002   81945640   12752112 1.049e+10
</code></pre>

<p>원본데이터 dart8.xls와 비교를 해보니 불러온 데이터에 아무런 오류가
없음을 확인할 수 있었습니다.</p>

<h3>엑셀 파일내 모든 워크시트 다 불러오기:</h3>

<p>그러나, 이것은 하나의 워크시트만을 불러온 것으로 전체 워크시트를
불러오고자 하는 우리의 목적을 달성한 것은 아닙니다. 따라서 아래와 같이
워크시트를 모두 불러오는 오도록 합니다.</p>

<pre><code class="r">wb &lt;- loadWorkbook(&quot;dart8.xls&quot;)
wb
</code></pre>

<pre><code>## [1] &quot;dart8.xls&quot;
</code></pre>

<pre><code class="r">tmp &lt;- readWorksheet(wb, sheet = getSheets(wb))
</code></pre>

<p>각각의 워크시트가 리스트 tmp의 각 구성요소에 성공적으로
불러들여졌습니다. 실제로 이것은 아래와 같이 반복문의 개념을 통해
이루어진 것입니다.</p>

<h3>모든 워크시트의 이름 확인:</h3>

<p>각각의 워크시트를 읽어오기 위해서는 먼저 어떤 이름을 가진 워크시트가
몇개가 있는지 알아야 할 것입니다.</p>

<pre><code class="r">wid &lt;- getSheets(wb)
wid
</code></pre>

<pre><code>## [1] &quot;하나투어&quot;     &quot;레드캡투어&quot;   &quot;모두투어&quot;     &quot;세중&quot;        
## [5] &quot;참좋은레져&quot;   &quot;롯데관광개발&quot; &quot;자유투어&quot;     &quot;비티앤아이&quot;
</code></pre>

<p>이 이름의 목록이 이미 불러들어온 목록과 일치함을 알 수 있습니다.</p>

<pre><code class="r">names(tmp)
</code></pre>

<pre><code>## [1] &quot;하나투어&quot;     &quot;레드캡투어&quot;   &quot;모두투어&quot;     &quot;세중&quot;        
## [5] &quot;참좋은레져&quot;   &quot;롯데관광개발&quot; &quot;자유투어&quot;     &quot;비티앤아이&quot;
</code></pre>

<p>워크시트를 순차적으로 불러오는 반복문을 수행해 봅니다.</p>

<pre><code class="r">tmp &lt;- list()
for (idx in getSheets(wb)) tmp[[idx]] &lt;- readWorksheetFromFile(file = &quot;dart8.xls&quot;, 
    sheet = idx)
tmp
</code></pre>

<pre><code>## $하나투어
##    구....분 광고선전비 교육훈련비    매출액
## 1      2000  1.617e+08   18002000 5.616e+09
## 2      2001  8.049e+07   28146500 7.189e+09
## 3      2001  1.708e+08   12965900 7.949e+09
## 4      2001  6.567e+07   26468000 1.151e+10
## 5      2001  2.780e+07   16838062 7.799e+09
## 6      2002  8.195e+07   12752112 1.049e+10
## 7      2002  3.031e+08    8428100 1.096e+10
## 8      2002  4.383e+08    3475560 1.864e+10
## 9      2002  5.285e+08    8138020 1.268e+10
## 10     2003  4.295e+08   14535990 1.486e+10
## 11     2003  6.402e+07    5109500 7.029e+09
## 12     2003  3.368e+08   11394917 2.089e+10
## 13     2003  4.389e+08   14812754 1.565e+10
## 14     2004  3.156e+08   10338300 1.764e+10
## 15     2004  7.587e+08   21191288 1.547e+10
## 16     2004  1.153e+09    5783080 2.679e+10
## 17     2004  1.035e+09   54309865 1.986e+10
## 18     2005  6.414e+08    5388960 2.327e+10
## 19     2005  1.165e+09   45028986 2.297e+10
## 20     2005  9.926e+08   11348510 3.767e+10
## 21     2005  1.372e+09   62163640 2.712e+10
## 22     2006  9.206e+08   13672836 3.975e+10
## 23     2006  2.124e+09  132961683 3.191e+10
## 24     2006  1.929e+09    2985880 4.861e+10
## 25     2006  2.393e+09  102367110 4.604e+10
## 26     2007  1.239e+09   35432682 4.982e+10
## 27     2007  2.059e+09   94954440 4.243e+10
## 28     2007  1.741e+09          0 6.063e+10
## 29     2007  1.771e+09   40011868 4.642e+10
## 30     2008  1.433e+09   10453124 5.762e+10
## 31     2008  2.098e+09   65203394 4.391e+10
## 32     2008  1.398e+09   15837118 4.352e+10
## 33     2008  7.275e+08   -3735654 2.773e+10
## 34     2009  5.288e+08   10678454 3.063e+10
## 35     2009  1.005e+09    4777258 2.964e+10
## 36     2009  6.797e+08    5375226 3.485e+10
## 37     2009  5.282e+08  -20830938 2.879e+10
## 38     2010  1.056e+09   44554342 4.848e+10
## 39     2010  2.612e+09   34151731 4.845e+10
## 40     2010  1.723e+09          0 6.625e+10
## 41     2010  2.930e+09   98244331 5.494e+10
## 42     2011  2.449e+09   36710000 6.351e+10
## 43     2011  2.818e+09   58809000 4.755e+10
## 44     2011  2.357e+09   27714000 6.619e+10
## 
## $레드캡투어
##    구....분 광고선전비 교육훈련비    매출액
## 1      2000  1.840e+06          0 1.093e+09
## 2      2000  1.134e+06          0 1.515e+09
## 3      2000  9.300e+05    1246020 2.130e+09
## 4      2000  1.001e+07          0 3.973e+09
## 5      2001  5.440e+06     100000 1.261e+09
## 6      2001  4.180e+06     110000 3.054e+09
## 7      2001  6.444e+05          0 1.696e+09
## 8      2001         NA          0 4.097e+09
## 9      2002  8.000e+04      50000 1.843e+09
## 10     2002  5.864e+06      80000 1.435e+09
## 11     2002  1.600e+05     400000 7.678e+08
## 12     2002  0.000e+00    1320000 2.203e+09
## 13     2003  8.400e+05     180000 1.019e+09
## 14     2003  1.000e+05      80000 8.175e+08
## 15     2003  0.000e+00     130000 3.025e+08
## 16     2003  9.000e+03      44000 2.047e+08
## 17     2004  2.000e+06          0 5.520e+08
## 18     2004  3.578e+06     240000 9.538e+08
## 19     2004  0.000e+00     892430 1.187e+09
## 20     2004  0.000e+00     -97570 6.738e+08
## 21     2005  8.400e+05     160000 1.282e+09
## 22     2005  0.000e+00          0 1.637e+09
## 23     2005  5.500e+05          0 1.220e+09
## 24     2005  0.000e+00      80000 6.048e+08
## 25     2006  8.400e+05      80000 5.681e+08
## 26     2006  5.500e+05     240000 6.055e+08
## 27     2006  1.980e+06          0 9.385e+08
## 28     2006  1.625e+06     120000 1.271e+09
## 29     2007  7.677e+08   27479356 1.391e+10
## 30     2007  1.043e+09   62698927 1.433e+10
## 31     2007  1.479e+09   43398756 1.637e+10
## 32     2007  5.252e+08   57918044 2.667e+10
## 33     2008  0.000e+00          0 1.993e+10
## 34     2008  1.826e+09   96007272 2.091e+10
## 35     2008  2.748e+09  145562000 1.927e+10
## 36     2008 -1.432e+09  -59481092 1.822e+10
## 37     2009  2.154e+08    5027000 2.086e+10
## 38     2009  1.817e+08   54300000 2.081e+10
## 39     2009  5.037e+08   30857000 2.020e+10
## 40     2009  2.208e+07   52101000 2.128e+10
## 41     2010  2.853e+08    3554000 2.627e+10
## 42     2010  3.500e+08   30268000 3.340e+10
## 43     2010  3.774e+08   50701000 2.859e+10
## 44     2010  2.794e+08   94395000 2.931e+10
## 45     2011  3.963e+08   34736000 3.593e+10
## 46     2011  3.854e+08   47663000 3.518e+10
## 47     2011  2.799e+08  101540000 3.394e+10
## 
## $모두투어
##    구....분 광고선전비 교육훈련비    매출액
## 1      2005  2.409e+08          0 8.145e+09
## 2      2005  4.637e+08          0 8.548e+09
## 3      2005  5.484e+08          0 1.279e+10
## 4      2005  5.520e+07          0 9.392e+09
## 5      2006  7.206e+08          0 1.467e+10
## 6      2006  8.681e+08          0 1.236e+10
## 7      2006  9.870e+08    2075000 1.999e+10
## 8      2006  1.944e+09   19036000 1.936e+10
## 9      2007  1.604e+09   21327441 2.269e+10
## 10     2007  1.487e+09   13137318 1.937e+10
## 11     2007  3.423e+09   53335300 2.953e+10
## 12     2007  1.260e+09   28193029 2.276e+10
## 13     2008  1.204e+09   13200204 2.653e+10
## 14     2008  2.680e+09   66144746 2.094e+10
## 15     2008  1.461e+09   34482480 2.314e+10
## 16     2008  7.011e+08   12212590 1.266e+10
## 17     2009  5.445e+08    4611600 1.304e+10
## 18     2009  4.202e+08   18224856 1.404e+10
## 19     2009  5.865e+08    6552350 1.783e+10
## 20     2009  4.618e+08    5522500 1.647e+10
## 21     2010  6.271e+08   11581130 2.500e+10
## 22     2010  8.967e+08   29407378 2.633e+10
## 23     2010  1.266e+09   20890280 3.647e+10
## 24     2010  1.177e+09   16647180 2.929e+10
## 25     2011  1.119e+09   21106000 3.386e+10
## 26     2011  1.263e+09   23868000 2.579e+10
## 27     2011  1.067e+09   16640000 3.634e+10
## 
## $세중
##    구....분 광고선전비 교육훈련비    매출액
## 1      2000  -14386068    3890650 9.104e+08
## 2      2000  993896486     159218 2.818e+09
## 3      2001  127116000    6420000 1.884e+09
## 4      2001  469787614    4204553 1.674e+09
## 5      2001  405677848    9285253 2.043e+09
## 6      2001  120953120   19780923 1.993e+09
## 7      2002   86683346   10914207 1.455e+09
## 8      2002  206628774   24193922 1.404e+09
## 9      2002   60978586    4247382 1.179e+09
## 10     2002   78896343    1647320 1.499e+09
## 11     2003   32975680    1100000 1.072e+09
## 12     2003   44874732     860000 1.585e+09
## 13     2003   31769502    1365000 1.220e+09
## 14     2003  756978698   61904440 3.380e+09
## 15     2004   44584722    2977870 7.566e+08
## 16     2004  163037461    4677680 1.960e+09
## 17     2004  166148967    2033485 1.276e+09
## 18     2004  635019271    2850530 3.147e+09
## 19     2005   53200074     900000 1.097e+09
## 20     2005  163908857     412000 1.446e+09
## 21     2005   70423589     589500 9.007e+08
## 22     2005  105881433     819320 1.725e+09
## 23     2006   72483619     500208 3.087e+09
## 24     2006   95598931     680000 3.699e+09
## 25     2006 1061239746    5708314 1.849e+10
## 26     2006 2606931469   60229861 3.557e+10
## 27     2007  685084202   16190280 1.696e+10
## 28     2007 1279207876   29395300 1.992e+10
## 29     2007 1152432010   17369340 1.927e+10
## 30     2007 1349318078   -7782930 1.620e+10
## 31     2008  930137416   29007679 1.646e+10
## 32     2008 1006599592    1090739 1.828e+10
## 33     2008  267514376    9583390 1.916e+10
## 34     2008  131415228   24538080 1.805e+10
## 35     2009  128959936    1252642 1.360e+10
## 36     2009  164430118    5023976 1.568e+10
## 37     2009   56881950    6980850 1.613e+10
## 38     2009   76691949    7046329 1.529e+10
## 39     2010   92244120   15798800 1.481e+10
## 40     2010  190779700   23429324 1.912e+10
## 41     2010   48997402   -4759221 2.028e+10
## 42     2010  102439249    4092070 2.041e+10
## 43     2011          0          0 1.938e+10
## 44     2011  341933000          0 2.238e+10
## 45     2011   19735000          0 2.183e+10
## 
## $참좋은레져
##    구....분 광고선전비 교육훈련비    매출액
## 1      2007     500000          0 2.915e+09
## 2      2007    2836412          0 6.783e+09
## 3      2007   67680500         NA 4.926e+09
## 4      2007   24490909         NA 3.857e+09
## 5      2008   70500000         NA 5.791e+09
## 6      2008   15638356         NA 1.110e+10
## 7      2008  332926664         NA 1.171e+10
## 8      2008  401777158         NA 6.093e+09
## 9      2009  505167621         NA 1.114e+10
## 10     2009  672752955         NA 1.404e+10
## 11     2009  563375028         NA 1.461e+10
## 12     2009  754611174         NA 7.020e+09
## 13     2010  663249619         NA 8.464e+09
## 14     2010  670122403         NA 1.364e+10
## 15     2010  734878924         NA 1.472e+10
## 16     2010  694355548         NA 7.595e+09
## 17     2011  773227000         NA 1.464e+10
## 18     2011  743366000         NA 1.730e+10
## 19     2011  610507000         NA 1.435e+10
## 
## $롯데관광개발
##    구....분 광고선전비 교육훈련비    매출액
## 1      2006  1.037e+09    6881040 8.990e+09
## 2      2006  2.046e+09    5399250 1.049e+10
## 3      2006  2.740e+09   15348250 1.494e+10
## 4      2006  1.255e+09   21589250 1.218e+10
## 5      2007  1.195e+09   27700180 1.237e+10
## 6      2007  1.309e+09   26722010 1.150e+10
## 7      2007  1.062e+09   32002591 1.688e+10
## 8      2007  9.867e+08   19226091 1.085e+10
## 9      2008  9.777e+08   23188682 1.295e+10
## 10     2008  9.845e+08   24090040 1.100e+10
## 11     2008  1.158e+09   36495000 1.080e+10
## 12     2008  4.869e+08   25375633 6.545e+09
## 13     2009  4.776e+08   19607350 5.582e+09
## 14     2009  5.696e+08   20698260 7.089e+09
## 15     2009  6.001e+08   28783950 7.726e+09
## 16     2009  5.468e+08   18322830 5.515e+09
## 17     2010  6.602e+08   28187000 7.761e+09
## 18     2010  6.136e+08   17553344 8.634e+09
## 19     2010  6.092e+08   30269450 1.256e+10
## 20     2010  6.650e+08   18269420 9.821e+09
## 21     2011  6.071e+08          0 9.707e+09
## 22     2011  6.703e+08   58419000 1.105e+10
## 23     2011  7.964e+08   27963000 1.349e+10
## 
## $자유투어
##    구....분 광고선전비 교육훈련비    매출액
## 1      2001    3360000    5544980 4.697e+09
## 2      2001    1620000    2584050 8.194e+09
## 3      2002   27836700   24824070 2.846e+09
## 4      2002    7883500    5848337 5.352e+09
## 5      2002   -2487500    1392550 3.062e+09
## 6      2002   20300000    3866420 1.727e+09
## 7      2003   16939000   10214408 1.189e+09
## 8      2003    7540000    3859000 2.233e+09
## 9      2003    7364000    1955000 1.015e+09
## 10     2003    1799636    2518441 3.207e+09
## 11     2004    8724000    3903000 1.803e+09
## 12     2004    7234000     540000 1.986e+09
## 13     2004    4484000     581000 1.066e+09
## 14     2004    8747995     459883 5.432e+09
## 15     2005    3140000     160000 2.039e+08
## 16     2005          0    2974000 4.649e+08
## 17     2005    1035000     500000 3.571e+08
## 18     2005  594003623     489750 2.622e+09
## 19     2006  844918000     400000 3.761e+09
## 20     2006 1159472000     184000 3.316e+09
## 21     2006 1640866000     720000 4.113e+09
## 22     2006 1147109888     914990 3.657e+09
## 23     2007 1167079621     180000 4.506e+09
## 24     2007 1193941000     100000 3.820e+09
## 25     2007 1105316438          0 5.894e+09
## 26     2007 1007781948     620000 4.010e+09
## 27     2008  975582113     100000 4.803e+09
## 28     2008 1043178000    2090000 4.483e+09
## 29     2008 1310815272    2480800 4.250e+09
## 30     2008  510565418    1347200 2.470e+09
## 31     2009  653303451    1066590 4.824e+09
## 32     2009  565423497          0 2.741e+09
## 33     2009  650179780    -706010 7.023e+09
## 34     2009  740856031     514920 1.168e+10
## 35     2010  817154204     516680 1.132e+10
## 36     2010  914617215     364020 6.841e+09
## 37     2010  932169708     852300 1.046e+10
## 38     2010 1020382617    1204920 5.569e+09
## 39     2011 1025380000     796000 8.351e+09
## 40     2011  906785000     820000 6.311e+09
## 41     2011 2857454000    1669000 5.680e+09
## 
## $비티앤아이
##    구....분 광고선전비 교육훈련비    매출액
## 1      2001  119792000    8233359 2.956e+09
## 2      2001  271838219   12481915 2.717e+09
## 3      2001  113744005   13981556 2.193e+09
## 4      2001  125040916    8300270 2.639e+09
## 5      2002   92779137   13502440 1.743e+09
## 6      2002  253821435    8046800 2.490e+09
## 7      2002  114540480   10029658 2.086e+09
## 8      2002  115121935    5321615 2.830e+09
## 9      2003  106609957   11754857 1.787e+09
## 10     2003  160728146   14233740 2.136e+09
## 11     2003   86676615   17696670 1.847e+09
## 12     2003  180364176   14576780 2.711e+09
## 13     2004  107319947    7782450 1.483e+09
## 14     2004  178475843   16184590 2.241e+09
## 15     2004   92313337   19306137 2.601e+09
## 16     2004  209758381   14388830 2.531e+09
## 17     2005  184206999    6283925 2.202e+09
## 18     2005  220888403   12288850 2.748e+09
## 19     2005  145568323   13268710 2.347e+09
## 20     2005  263592370   15133596 2.804e+09
## 21     2006  130276877    8108340 1.482e+09
## 22     2006  193554491   11101620 1.894e+09
## 23     2006  119956546    6036140 1.791e+09
## 24     2006  286486447    3967950 2.406e+09
## 25     2007   65900692    3990710 1.180e+09
## 26     2007  207270104    6455710 1.412e+09
## 27     2007  133377642    8215550 1.186e+09
## 28     2007  206995961    5550920 1.450e+09
## 29     2008  106548846    2848200 1.013e+09
## 30     2008  230633746    6965970 1.274e+09
## 31     2008  205953497   13846645 3.704e+09
## 32     2008  375688451    3531000 3.475e+09
## 33     2009   81561788   13427260 2.543e+09
## 34     2009  122025637     260000 2.490e+09
## 35     2009  120160963     720000 2.677e+09
## 36     2009  173144605          0 3.466e+09
## 37     2010  116821788    2240000 2.270e+09
## 38     2010  209095000   25614000 3.771e+09
## 39     2010  148188000    6260000 4.987e+09
## 40     2010  165032212    5740000 1.431e+09
## 41     2011  180268000    1300000 5.490e+09
## 42     2011  198959000     598000 3.262e+09
## 43     2011  144049000     500000 1.393e+09
</code></pre>

<h3>리스트로 불러들인 데이터를 하나로 합치기:</h3>

<p>모든 데이터가 성공적으로 불러들여왔음을 확인할 수 있었습니다. 또한 모든
워크시트는 동일한 개수의 변수명 목록을 가지고 있으며, 이들은 모두 같은
변수명을 가집니다. 그런데, 이 데이터는 현재 리스트라는 데이터형식에
들어있습니다. 분석을 위해서는 데이터프레임에 하나로 통합된 데이터가 좋을
것입니다.</p>

<p>따라서, 아래와 같이 수행합니다.</p>

<pre><code class="r">mydata &lt;- do.call(rbind, tmp)
head(mydata)
</code></pre>

<pre><code>##            구....분 광고선전비 교육훈련비    매출액
## 하나투어.1     2000  161702806   18002000 5.616e+09
## 하나투어.2     2001   80485618   28146500 7.189e+09
## 하나투어.3     2001  170827271   12965900 7.949e+09
## 하나투어.4     2001   65667863   26468000 1.151e+10
## 하나투어.5     2001   27804868   16838062 7.799e+09
## 하나투어.6     2002   81945640   12752112 1.049e+10
</code></pre>

<pre><code class="r">tail(mydata)
</code></pre>

<pre><code>##               구....분 광고선전비 교육훈련비    매출액
## 비티앤아이.38     2010  209095000   25614000 3.771e+09
## 비티앤아이.39     2010  148188000    6260000 4.987e+09
## 비티앤아이.40     2010  165032212    5740000 1.431e+09
## 비티앤아이.41     2011  180268000    1300000 5.490e+09
## 비티앤아이.42     2011  198959000     598000 3.262e+09
## 비티앤아이.43     2011  144049000     500000 1.393e+09
</code></pre>

<p>이제서야 하나로 잘 정리된 데이터로 만들어졌습니다.</p>

<h3>변수명 바꾸기</h3>

<p>그런데, 첫번째 변수명이 원본데이터에서는 “구 분” 이라고 되어 있으나,
불러들인 데이터에서는 “구&hellip;.분”이라고 되어 있습니다. 이는 XLConnect
패키지에서 변수명을 처리할때 빈공간 (화이트 스페이스)를 &hellip; 으로
대체했기 때문입니다. 점 하나가 스페이스 하나입니다. 그런데, 생각을
해보니 “구분” 이라는 변수명이 데이터를 표현하는데 적절하지 않은 것
같습니다. 이 변수의 값들은 날짜를 의미하기 때문에 “분기” 라고 변경하는
것이 더욱 적절할 것입니다.</p>

<p>그래서, 아래와 같이 변수명을 변경합니다.</p>

<pre><code class="r">names(mydata)[1] &lt;- c(&quot;년도별분기&quot;)
names(mydata)
</code></pre>

<pre><code>## [1] &quot;년도별분기&quot; &quot;광고선전비&quot; &quot;교육훈련비&quot; &quot;매출액&quot;
</code></pre>

<h3>데이터 구조확인:</h3>

<p>이제 데이터의 구조를 살펴봅니다.</p>

<pre><code class="r">str(mydata)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    289 obs. of  4 variables:
##  $ 년도별분기: num  2000 2001 2001 2001 2001 ...
##  $ 광고선전비: num  1.62e+08 8.05e+07 1.71e+08 6.57e+07 2.78e+07 ...
##  $ 교육훈련비: num  18002000 28146500 12965900 26468000 16838062 ...
##  $ 매출액    : num  5.62e+09 7.19e+09 7.95e+09 1.15e+10 7.80e+09 ...
</code></pre>

<p>총 289개의 관측치가 4개의 변수로부터 측정되었음을 확인할 수 있었습니다.
그런데, 데이터형이 data.frame입니다. 그 이유는 이전에 do.call()를
이용하여 한데 묶었기 때문입니다. 정말 데이터프레임일까요? 이전에
설명했듯이 데이터프레임은 리스트의 특수한 경우이기 때문입니다.</p>

<pre><code class="r">is.data.frame(mydata)
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<pre><code class="r">is.list(mydata)
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<h3>중복을 확인하기:</h3>

<p>그런데, 합쳐진 데이터 mydata를 다시 살펴보니 데이터가 어떤
워크시트로부터 몇 번째 데이터인지를 구분해주는 지시자가 없습니다. 이
지시자의 특징은 각 행별로 절대로 중복이 없는 유일한 값이어야 한다는
점입니다. 이것을 우리는 프라이머리키(primary key)라고 합니다. 그런데,
mydata의 행이름을 보니, 이 정보를 포함하고 있습니다. 먼저, mydata의 행의
이름이 어떠한 중복이 있는지 확인해 봅니다.</p>

<pre><code class="r">rownames(mydata)
</code></pre>

<pre><code>##   [1] &quot;하나투어.1&quot;      &quot;하나투어.2&quot;      &quot;하나투어.3&quot;     
##   [4] &quot;하나투어.4&quot;      &quot;하나투어.5&quot;      &quot;하나투어.6&quot;     
##   [7] &quot;하나투어.7&quot;      &quot;하나투어.8&quot;      &quot;하나투어.9&quot;     
##  [10] &quot;하나투어.10&quot;     &quot;하나투어.11&quot;     &quot;하나투어.12&quot;    
##  [13] &quot;하나투어.13&quot;     &quot;하나투어.14&quot;     &quot;하나투어.15&quot;    
##  [16] &quot;하나투어.16&quot;     &quot;하나투어.17&quot;     &quot;하나투어.18&quot;    
##  [19] &quot;하나투어.19&quot;     &quot;하나투어.20&quot;     &quot;하나투어.21&quot;    
##  [22] &quot;하나투어.22&quot;     &quot;하나투어.23&quot;     &quot;하나투어.24&quot;    
##  [25] &quot;하나투어.25&quot;     &quot;하나투어.26&quot;     &quot;하나투어.27&quot;    
##  [28] &quot;하나투어.28&quot;     &quot;하나투어.29&quot;     &quot;하나투어.30&quot;    
##  [31] &quot;하나투어.31&quot;     &quot;하나투어.32&quot;     &quot;하나투어.33&quot;    
##  [34] &quot;하나투어.34&quot;     &quot;하나투어.35&quot;     &quot;하나투어.36&quot;    
##  [37] &quot;하나투어.37&quot;     &quot;하나투어.38&quot;     &quot;하나투어.39&quot;    
##  [40] &quot;하나투어.40&quot;     &quot;하나투어.41&quot;     &quot;하나투어.42&quot;    
##  [43] &quot;하나투어.43&quot;     &quot;하나투어.44&quot;     &quot;레드캡투어.1&quot;   
##  [46] &quot;레드캡투어.2&quot;    &quot;레드캡투어.3&quot;    &quot;레드캡투어.4&quot;   
##  [49] &quot;레드캡투어.5&quot;    &quot;레드캡투어.6&quot;    &quot;레드캡투어.7&quot;   
##  [52] &quot;레드캡투어.8&quot;    &quot;레드캡투어.9&quot;    &quot;레드캡투어.10&quot;  
##  [55] &quot;레드캡투어.11&quot;   &quot;레드캡투어.12&quot;   &quot;레드캡투어.13&quot;  
##  [58] &quot;레드캡투어.14&quot;   &quot;레드캡투어.15&quot;   &quot;레드캡투어.16&quot;  
##  [61] &quot;레드캡투어.17&quot;   &quot;레드캡투어.18&quot;   &quot;레드캡투어.19&quot;  
##  [64] &quot;레드캡투어.20&quot;   &quot;레드캡투어.21&quot;   &quot;레드캡투어.22&quot;  
##  [67] &quot;레드캡투어.23&quot;   &quot;레드캡투어.24&quot;   &quot;레드캡투어.25&quot;  
##  [70] &quot;레드캡투어.26&quot;   &quot;레드캡투어.27&quot;   &quot;레드캡투어.28&quot;  
##  [73] &quot;레드캡투어.29&quot;   &quot;레드캡투어.30&quot;   &quot;레드캡투어.31&quot;  
##  [76] &quot;레드캡투어.32&quot;   &quot;레드캡투어.33&quot;   &quot;레드캡투어.34&quot;  
##  [79] &quot;레드캡투어.35&quot;   &quot;레드캡투어.36&quot;   &quot;레드캡투어.37&quot;  
##  [82] &quot;레드캡투어.38&quot;   &quot;레드캡투어.39&quot;   &quot;레드캡투어.40&quot;  
##  [85] &quot;레드캡투어.41&quot;   &quot;레드캡투어.42&quot;   &quot;레드캡투어.43&quot;  
##  [88] &quot;레드캡투어.44&quot;   &quot;레드캡투어.45&quot;   &quot;레드캡투어.46&quot;  
##  [91] &quot;레드캡투어.47&quot;   &quot;모두투어.1&quot;      &quot;모두투어.2&quot;     
##  [94] &quot;모두투어.3&quot;      &quot;모두투어.4&quot;      &quot;모두투어.5&quot;     
##  [97] &quot;모두투어.6&quot;      &quot;모두투어.7&quot;      &quot;모두투어.8&quot;     
## [100] &quot;모두투어.9&quot;      &quot;모두투어.10&quot;     &quot;모두투어.11&quot;    
## [103] &quot;모두투어.12&quot;     &quot;모두투어.13&quot;     &quot;모두투어.14&quot;    
## [106] &quot;모두투어.15&quot;     &quot;모두투어.16&quot;     &quot;모두투어.17&quot;    
## [109] &quot;모두투어.18&quot;     &quot;모두투어.19&quot;     &quot;모두투어.20&quot;    
## [112] &quot;모두투어.21&quot;     &quot;모두투어.22&quot;     &quot;모두투어.23&quot;    
## [115] &quot;모두투어.24&quot;     &quot;모두투어.25&quot;     &quot;모두투어.26&quot;    
## [118] &quot;모두투어.27&quot;     &quot;세중.1&quot;          &quot;세중.2&quot;         
## [121] &quot;세중.3&quot;          &quot;세중.4&quot;          &quot;세중.5&quot;         
## [124] &quot;세중.6&quot;          &quot;세중.7&quot;          &quot;세중.8&quot;         
## [127] &quot;세중.9&quot;          &quot;세중.10&quot;         &quot;세중.11&quot;        
## [130] &quot;세중.12&quot;         &quot;세중.13&quot;         &quot;세중.14&quot;        
## [133] &quot;세중.15&quot;         &quot;세중.16&quot;         &quot;세중.17&quot;        
## [136] &quot;세중.18&quot;         &quot;세중.19&quot;         &quot;세중.20&quot;        
## [139] &quot;세중.21&quot;         &quot;세중.22&quot;         &quot;세중.23&quot;        
## [142] &quot;세중.24&quot;         &quot;세중.25&quot;         &quot;세중.26&quot;        
## [145] &quot;세중.27&quot;         &quot;세중.28&quot;         &quot;세중.29&quot;        
## [148] &quot;세중.30&quot;         &quot;세중.31&quot;         &quot;세중.32&quot;        
## [151] &quot;세중.33&quot;         &quot;세중.34&quot;         &quot;세중.35&quot;        
## [154] &quot;세중.36&quot;         &quot;세중.37&quot;         &quot;세중.38&quot;        
## [157] &quot;세중.39&quot;         &quot;세중.40&quot;         &quot;세중.41&quot;        
## [160] &quot;세중.42&quot;         &quot;세중.43&quot;         &quot;세중.44&quot;        
## [163] &quot;세중.45&quot;         &quot;참좋은레져.1&quot;    &quot;참좋은레져.2&quot;   
## [166] &quot;참좋은레져.3&quot;    &quot;참좋은레져.4&quot;    &quot;참좋은레져.5&quot;   
## [169] &quot;참좋은레져.6&quot;    &quot;참좋은레져.7&quot;    &quot;참좋은레져.8&quot;   
## [172] &quot;참좋은레져.9&quot;    &quot;참좋은레져.10&quot;   &quot;참좋은레져.11&quot;  
## [175] &quot;참좋은레져.12&quot;   &quot;참좋은레져.13&quot;   &quot;참좋은레져.14&quot;  
## [178] &quot;참좋은레져.15&quot;   &quot;참좋은레져.16&quot;   &quot;참좋은레져.17&quot;  
## [181] &quot;참좋은레져.18&quot;   &quot;참좋은레져.19&quot;   &quot;롯데관광개발.1&quot; 
## [184] &quot;롯데관광개발.2&quot;  &quot;롯데관광개발.3&quot;  &quot;롯데관광개발.4&quot; 
## [187] &quot;롯데관광개발.5&quot;  &quot;롯데관광개발.6&quot;  &quot;롯데관광개발.7&quot; 
## [190] &quot;롯데관광개발.8&quot;  &quot;롯데관광개발.9&quot;  &quot;롯데관광개발.10&quot;
## [193] &quot;롯데관광개발.11&quot; &quot;롯데관광개발.12&quot; &quot;롯데관광개발.13&quot;
## [196] &quot;롯데관광개발.14&quot; &quot;롯데관광개발.15&quot; &quot;롯데관광개발.16&quot;
## [199] &quot;롯데관광개발.17&quot; &quot;롯데관광개발.18&quot; &quot;롯데관광개발.19&quot;
## [202] &quot;롯데관광개발.20&quot; &quot;롯데관광개발.21&quot; &quot;롯데관광개발.22&quot;
## [205] &quot;롯데관광개발.23&quot; &quot;자유투어.1&quot;      &quot;자유투어.2&quot;     
## [208] &quot;자유투어.3&quot;      &quot;자유투어.4&quot;      &quot;자유투어.5&quot;     
## [211] &quot;자유투어.6&quot;      &quot;자유투어.7&quot;      &quot;자유투어.8&quot;     
## [214] &quot;자유투어.9&quot;      &quot;자유투어.10&quot;     &quot;자유투어.11&quot;    
## [217] &quot;자유투어.12&quot;     &quot;자유투어.13&quot;     &quot;자유투어.14&quot;    
## [220] &quot;자유투어.15&quot;     &quot;자유투어.16&quot;     &quot;자유투어.17&quot;    
## [223] &quot;자유투어.18&quot;     &quot;자유투어.19&quot;     &quot;자유투어.20&quot;    
## [226] &quot;자유투어.21&quot;     &quot;자유투어.22&quot;     &quot;자유투어.23&quot;    
## [229] &quot;자유투어.24&quot;     &quot;자유투어.25&quot;     &quot;자유투어.26&quot;    
## [232] &quot;자유투어.27&quot;     &quot;자유투어.28&quot;     &quot;자유투어.29&quot;    
## [235] &quot;자유투어.30&quot;     &quot;자유투어.31&quot;     &quot;자유투어.32&quot;    
## [238] &quot;자유투어.33&quot;     &quot;자유투어.34&quot;     &quot;자유투어.35&quot;    
## [241] &quot;자유투어.36&quot;     &quot;자유투어.37&quot;     &quot;자유투어.38&quot;    
## [244] &quot;자유투어.39&quot;     &quot;자유투어.40&quot;     &quot;자유투어.41&quot;    
## [247] &quot;비티앤아이.1&quot;    &quot;비티앤아이.2&quot;    &quot;비티앤아이.3&quot;   
## [250] &quot;비티앤아이.4&quot;    &quot;비티앤아이.5&quot;    &quot;비티앤아이.6&quot;   
## [253] &quot;비티앤아이.7&quot;    &quot;비티앤아이.8&quot;    &quot;비티앤아이.9&quot;   
## [256] &quot;비티앤아이.10&quot;   &quot;비티앤아이.11&quot;   &quot;비티앤아이.12&quot;  
## [259] &quot;비티앤아이.13&quot;   &quot;비티앤아이.14&quot;   &quot;비티앤아이.15&quot;  
## [262] &quot;비티앤아이.16&quot;   &quot;비티앤아이.17&quot;   &quot;비티앤아이.18&quot;  
## [265] &quot;비티앤아이.19&quot;   &quot;비티앤아이.20&quot;   &quot;비티앤아이.21&quot;  
## [268] &quot;비티앤아이.22&quot;   &quot;비티앤아이.23&quot;   &quot;비티앤아이.24&quot;  
## [271] &quot;비티앤아이.25&quot;   &quot;비티앤아이.26&quot;   &quot;비티앤아이.27&quot;  
## [274] &quot;비티앤아이.28&quot;   &quot;비티앤아이.29&quot;   &quot;비티앤아이.30&quot;  
## [277] &quot;비티앤아이.31&quot;   &quot;비티앤아이.32&quot;   &quot;비티앤아이.33&quot;  
## [280] &quot;비티앤아이.34&quot;   &quot;비티앤아이.35&quot;   &quot;비티앤아이.36&quot;  
## [283] &quot;비티앤아이.37&quot;   &quot;비티앤아이.38&quot;   &quot;비티앤아이.39&quot;  
## [286] &quot;비티앤아이.40&quot;   &quot;비티앤아이.41&quot;   &quot;비티앤아이.42&quot;  
## [289] &quot;비티앤아이.43&quot;
</code></pre>

<p>그런데 이렇게 일일이 눈으로는 확인할 수 없지 않겠나&hellip; 하는 생각이
불현듯 떠오릅니다. 그래서 중복이 있고 없고를 한번에 알 수 있는 길이
없을까 하는 생각을 합니다.</p>

<pre><code class="r">all(!duplicated(rownames(mydata)))
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<p>duplicated()라는 함수는 중복을 체크하여 TRUE 또는 FALSE를 알려줍니다.
!(느낌표)는 반대라는 의미를 나타내는 연산자입니다. 즉, !duplicated()란
중복이 없나요? 를 물어보는 것입니다. 그리고 all()이라는 함수는 벡터내에
있는 값이 모두 TRUE인지를 확인해줍니다. 이 결과가 TRUE이므로 행의 이름이
중복이 되지 않았음을 확인하였습니다. 따라서, 이 정보를 프라이머리 키로
사용해도 될 것 같습니다.</p>

<h3>문자열를 주어진 문자를 이용하여 분리하기:</h3>

<p>그런데 생각을 해보니 여행사별로 분석을 수행할 수 있는데 이를 구분해 줄
수 있는 변수가 없습니다. 따라서, “여행사”라는 변수를 새로 만들어 mydata
데이터셋에 넣고자 합니다. 이를 수행하기 위해서는 strpsplit() 함수를
이용하여 아래와 같이 행이름의 문자열을 어떤 특수한 문자에 의해서 나누어
주는 것입니다.</p>

<pre><code class="r">head(strsplit(rownames(mydata), &quot;.&quot;, fixed = TRUE))
</code></pre>

<pre><code>## [[1]]
## [1] &quot;하나투어&quot; &quot;1&quot;       
## 
## [[2]]
## [1] &quot;하나투어&quot; &quot;2&quot;       
## 
## [[3]]
## [1] &quot;하나투어&quot; &quot;3&quot;       
## 
## [[4]]
## [1] &quot;하나투어&quot; &quot;4&quot;       
## 
## [[5]]
## [1] &quot;하나투어&quot; &quot;5&quot;       
## 
## [[6]]
## [1] &quot;하나투어&quot; &quot;6&quot;
</code></pre>

<p>그리고, 이렇게 리스트로 쪼개어진 변수명을 do.call()함수를 이용하여
행렬의 형태로 재조합한 것을 활용하는 것입니다.</p>

<pre><code class="r">head(do.call(rbind, strsplit(rownames(mydata), &quot;.&quot;, fixed = TRUE)))
</code></pre>

<pre><code>##      [,1]       [,2]
## [1,] &quot;하나투어&quot; &quot;1&quot; 
## [2,] &quot;하나투어&quot; &quot;2&quot; 
## [3,] &quot;하나투어&quot; &quot;3&quot; 
## [4,] &quot;하나투어&quot; &quot;4&quot; 
## [5,] &quot;하나투어&quot; &quot;5&quot; 
## [6,] &quot;하나투어&quot; &quot;6&quot;
</code></pre>

<h3>데이터프레임에 변수 추가하기</h3>

<p>그리고 여행사라는 변수를 생성합니다. 행이름은 더이상 필요하지 않으므로
삭제합니다.</p>

<pre><code class="r">mydata$여행사 &lt;- do.call(rbind, strsplit(rownames(mydata), &quot;.&quot;, fixed = TRUE))[, 
    1]
mydata$번호 &lt;- do.call(rbind, strsplit(rownames(mydata), &quot;.&quot;, fixed = TRUE))[, 
    2]
rownames(mydata) &lt;- NULL
head(mydata)
</code></pre>

<pre><code>##   년도별분기 광고선전비 교육훈련비    매출액   여행사 번호
## 1       2000  161702806   18002000 5.616e+09 하나투어    1
## 2       2001   80485618   28146500 7.189e+09 하나투어    2
## 3       2001  170827271   12965900 7.949e+09 하나투어    3
## 4       2001   65667863   26468000 1.151e+10 하나투어    4
## 5       2001   27804868   16838062 7.799e+09 하나투어    5
## 6       2002   81945640   12752112 1.049e+10 하나투어    6
</code></pre>

<p>이러한 방법으로 년도별 분기 변수를 좀 더 상세화 할 수 있을 것입니다.</p>

<pre><code class="r">yrQ &lt;- as.data.frame(do.call(rbind, strsplit(as.character(mydata$년도별분기), 
    &quot;.&quot;, fixed = TRUE)))
names(yrQ) &lt;- c(&quot;년도&quot;, &quot;월&quot;)
mydata &lt;- data.frame(mydata, yrQ)
head(mydata)
</code></pre>

<pre><code>##   년도별분기 광고선전비 교육훈련비    매출액   여행사 번호 년도 월
## 1       2000  161702806   18002000 5.616e+09 하나투어    1 2000 12
## 2       2001   80485618   28146500 7.189e+09 하나투어    2 2001 03
## 3       2001  170827271   12965900 7.949e+09 하나투어    3 2001 06
## 4       2001   65667863   26468000 1.151e+10 하나투어    4 2001 09
## 5       2001   27804868   16838062 7.799e+09 하나투어    5 2001 12
## 6       2002   81945640   12752112 1.049e+10 하나투어    6 2002 03
</code></pre>

<h3>결측치 확인하고 제거하기</h3>

<p>그런데, 데이터에 결측치들이 얼마나 있는지 살펴보아야 할 것입니다. 만약
있다면 어디에서 어떤 변수에서 결측치가 있으며, 이들을 삭제할 것인지
결정해야 합니다. 그래서 원본데이터 tmp를 살펴보았더니, 아래와 같이 NA 가
있습니다.</p>

<pre><code class="r">tmp$참좋은레져
</code></pre>

<pre><code>##    구....분 광고선전비 교육훈련비    매출액
## 1      2007     500000          0 2.915e+09
## 2      2007    2836412          0 6.783e+09
## 3      2007   67680500         NA 4.926e+09
## 4      2007   24490909         NA 3.857e+09
## 5      2008   70500000         NA 5.791e+09
## 6      2008   15638356         NA 1.110e+10
## 7      2008  332926664         NA 1.171e+10
## 8      2008  401777158         NA 6.093e+09
## 9      2009  505167621         NA 1.114e+10
## 10     2009  672752955         NA 1.404e+10
## 11     2009  563375028         NA 1.461e+10
## 12     2009  754611174         NA 7.020e+09
## 13     2010  663249619         NA 8.464e+09
## 14     2010  670122403         NA 1.364e+10
## 15     2010  734878924         NA 1.472e+10
## 16     2010  694355548         NA 7.595e+09
## 17     2011  773227000         NA 1.464e+10
## 18     2011  743366000         NA 1.730e+10
## 19     2011  610507000         NA 1.435e+10
</code></pre>

<p>그럼 하나로 뭉친 mydata 파일에서 어떻게 이러한 데이터를 찾아야 할까요?
is.na() 함수의 사용은 아래와 같은 결과를 줍니다.</p>

<pre><code class="r">head(is.na(mydata))
</code></pre>

<pre><code>##      년도별분기 광고선전비 교육훈련비 매출액 여행사  번호  년도    월
## [1,]      FALSE      FALSE      FALSE  FALSE  FALSE FALSE FALSE FALSE
## [2,]      FALSE      FALSE      FALSE  FALSE  FALSE FALSE FALSE FALSE
## [3,]      FALSE      FALSE      FALSE  FALSE  FALSE FALSE FALSE FALSE
## [4,]      FALSE      FALSE      FALSE  FALSE  FALSE FALSE FALSE FALSE
## [5,]      FALSE      FALSE      FALSE  FALSE  FALSE FALSE FALSE FALSE
## [6,]      FALSE      FALSE      FALSE  FALSE  FALSE FALSE FALSE FALSE
</code></pre>

<p>그렇다면 TRUE 라고 된 부분이 결측일 것입니다. 데이터를 한 눈에 살펴볼 수
없기 때문에 아래와 같이 합니다.</p>

<pre><code class="r">idx &lt;- which(is.na(mydata))
mydata[idx%%nrow(mydata), ]
</code></pre>

<pre><code>##     년도별분기 광고선전비 교육훈련비    매출액     여행사 번호 년도 월
## 52        2001         NA          0 4.097e+09 레드캡투어    8 2001 12
## 166       2007   67680500         NA 4.926e+09 참좋은레져    3 2007 09
## 167       2007   24490909         NA 3.857e+09 참좋은레져    4 2007 12
## 168       2008   70500000         NA 5.791e+09 참좋은레져    5 2008 03
## 169       2008   15638356         NA 1.110e+10 참좋은레져    6 2008 06
## 170       2008  332926664         NA 1.171e+10 참좋은레져    7 2008 09
## 171       2008  401777158         NA 6.093e+09 참좋은레져    8 2008 12
## 172       2009  505167621         NA 1.114e+10 참좋은레져    9 2009 03
## 173       2009  672752955         NA 1.404e+10 참좋은레져   10 2009 06
## 174       2009  563375028         NA 1.461e+10 참좋은레져   11 2009 09
## 175       2009  754611174         NA 7.020e+09 참좋은레져   12 2009 12
## 176       2010  663249619         NA 8.464e+09 참좋은레져   13 2010 03
## 177       2010  670122403         NA 1.364e+10 참좋은레져   14 2010 06
## 178       2010  734878924         NA 1.472e+10 참좋은레져   15 2010 09
## 179       2010  694355548         NA 7.595e+09 참좋은레져   16 2010 12
## 180       2011  773227000         NA 1.464e+10 참좋은레져   17 2011 03
## 181       2011  743366000         NA 1.730e+10 참좋은레져   18 2011 06
## 182       2011  610507000         NA 1.435e+10 참좋은레져   19 2011 09
</code></pre>

<p>이와 같은 논리를 이용하여 R은 결측치에 해당하는 레코드를 지워주는
na.exclude()라는 함수를 제공합니다.</p>

<pre><code class="r">mydatax &lt;- na.exclude(mydata)
mydatax[163:170, ]
</code></pre>

<pre><code>##     년도별분기 광고선전비 교육훈련비    매출액       여행사 번호 년도 월
## 164       2007  5.000e+05          0 2.915e+09   참좋은레져    1 2007 03
## 165       2007  2.836e+06          0 6.783e+09   참좋은레져    2 2007 06
## 183       2006  1.037e+09    6881040 8.990e+09 롯데관광개발    1 2006 03
## 184       2006  2.046e+09    5399250 1.049e+10 롯데관광개발    2 2006 06
## 185       2006  2.740e+09   15348250 1.494e+10 롯데관광개발    3 2006 09
## 186       2006  1.255e+09   21589250 1.218e+10 롯데관광개발    4 2006 12
## 187       2007  1.195e+09   27700180 1.237e+10 롯데관광개발    5 2007 03
## 188       2007  1.309e+09   26722010 1.150e+10 롯데관광개발    6 2007 06
</code></pre>

<h3>데이터프레임에서 변수삭제하기:</h3>

<p>“년도”와 “월”이라는 변수를 따로 생성하였기 때문에 이제 “년도별분기”라는
변수는 불필요하므로 변수를 삭제하도록 합니다.</p>

<pre><code class="r">mydatax &lt;- mydatax[c(FALSE, rep(TRUE, 7))]
head(mydatax)
</code></pre>

<pre><code>##   광고선전비 교육훈련비    매출액   여행사 번호 년도 월
## 1  161702806   18002000 5.616e+09 하나투어    1 2000 12
## 2   80485618   28146500 7.189e+09 하나투어    2 2001 03
## 3  170827271   12965900 7.949e+09 하나투어    3 2001 06
## 4   65667863   26468000 1.151e+10 하나투어    4 2001 09
## 5   27804868   16838062 7.799e+09 하나투어    5 2001 12
## 6   81945640   12752112 1.049e+10 하나투어    6 2002 03
</code></pre>

<p>그러고 보니, “월”이라는 변수는 분기별로 데이터를 모은 것이므로 “분기”로
변형하는 것이 좋을 듯 합니다. 먼저, “월”이라는 변수가 정말 3,6,9,12 월에
해당하는 값들만 가지고 있는지 확인을 해야할 것입니다.</p>

<pre><code class="r">names(table(mydatax$월))
</code></pre>

<pre><code>## [1] &quot;03&quot; &quot;06&quot; &quot;09&quot; &quot;12&quot;
</code></pre>

<p>따라서, “월”이라는 변수를 “분기”라는 변수로 변경합니다. 또한, 문자형을
요인형으로 변경하면서, 수준에 따라 라벨링을 함께 합니다.</p>

<pre><code class="r">mydatax$월 &lt;- factor(mydatax$월, levels = c(&quot;03&quot;, &quot;06&quot;, &quot;09&quot;, &quot;12&quot;), labels = c(&quot;1분기&quot;, 
    &quot;2분기&quot;, &quot;3분기&quot;, &quot;4분기&quot;))
names(mydatax)[7] &lt;- c(&quot;분기&quot;)
head(mydatax)
</code></pre>

<pre><code>##   광고선전비 교육훈련비    매출액   여행사 번호 년도  분기
## 1  161702806   18002000 5.616e+09 하나투어    1 2000 4분기
## 2   80485618   28146500 7.189e+09 하나투어    2 2001 1분기
## 3  170827271   12965900 7.949e+09 하나투어    3 2001 2분기
## 4   65667863   26468000 1.151e+10 하나투어    4 2001 3분기
## 5   27804868   16838062 7.799e+09 하나투어    5 2001 4분기
## 6   81945640   12752112 1.049e+10 하나투어    6 2002 1분기
</code></pre>

<h3>분할표 생성해보기:</h3>

<p>이제 간단한 분기와 년도에 따른 contingency table을 생성해봅니다.</p>

<pre><code class="r">ftable(mydatax$분기, mydatax$년도)
</code></pre>

<pre><code>##        2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011
##                                                                   
## 1분기     1    4    5    5    5    6    7    8    7    7    7    7
## 2분기     1    4    5    5    5    6    7    8    7    7    7    7
## 3분기     2    5    5    5    5    6    7    7    7    7    7    7
## 4분기     3    4    5    5    5    6    7    7    7    7    7    0
</code></pre>

<p>이 분할표를 여행사별로 출력해봅니다.</p>

<pre><code class="r">ftable(mydatax$여행사, mydatax$분기, mydatax$년도)
</code></pre>

<pre><code>##                     2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011
##                                                                                
## 세중         1분기     0    1    1    1    1    1    1    1    1    1    1    1
##              2분기     0    1    1    1    1    1    1    1    1    1    1    1
##              3분기     1    1    1    1    1    1    1    1    1    1    1    1
##              4분기     1    1    1    1    1    1    1    1    1    1    1    0
## 하나투어     1분기     0    1    1    1    1    1    1    1    1    1    1    1
##              2분기     0    1    1    1    1    1    1    1    1    1    1    1
##              3분기     0    1    1    1    1    1    1    1    1    1    1    1
##              4분기     1    1    1    1    1    1    1    1    1    1    1    0
## 모두투어     1분기     0    0    0    0    0    1    1    1    1    1    1    1
##              2분기     0    0    0    0    0    1    1    1    1    1    1    1
##              3분기     0    0    0    0    0    1    1    1    1    1    1    1
##              4분기     0    0    0    0    0    1    1    1    1    1    1    0
## 자유투어     1분기     0    0    1    1    1    1    1    1    1    1    1    1
##              2분기     0    0    1    1    1    1    1    1    1    1    1    1
##              3분기     0    1    1    1    1    1    1    1    1    1    1    1
##              4분기     0    1    1    1    1    1    1    1    1    1    1    0
## 레드캡투어   1분기     1    1    1    1    1    1    1    1    1    1    1    1
##              2분기     1    1    1    1    1    1    1    1    1    1    1    1
##              3분기     1    1    1    1    1    1    1    1    1    1    1    1
##              4분기     1    0    1    1    1    1    1    1    1    1    1    0
## 참좋은레져   1분기     0    0    0    0    0    0    0    1    0    0    0    0
##              2분기     0    0    0    0    0    0    0    1    0    0    0    0
##              3분기     0    0    0    0    0    0    0    0    0    0    0    0
##              4분기     0    0    0    0    0    0    0    0    0    0    0    0
## 비티앤아이   1분기     0    1    1    1    1    1    1    1    1    1    1    1
##              2분기     0    1    1    1    1    1    1    1    1    1    1    1
##              3분기     0    1    1    1    1    1    1    1    1    1    1    1
##              4분기     0    1    1    1    1    1    1    1    1    1    1    0
## 롯데관광개발 1분기     0    0    0    0    0    0    1    1    1    1    1    1
##              2분기     0    0    0    0    0    0    1    1    1    1    1    1
##              3분기     0    0    0    0    0    0    1    1    1    1    1    1
##              4분기     0    0    0    0    0    0    1    1    1    1    1    0
</code></pre>

<p>매번 데이터셋이름을 같이 쓰기가 너무 불편합니다. 따라서, 아래와 같이
with()를 사용해봅니다.</p>

<pre><code class="r">with(mydatax, ftable(분기, 년도))
</code></pre>

<pre><code>##       년도 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011
## 분기                                                                  
## 1분기         1    4    5    5    5    6    7    8    7    7    7    7
## 2분기         1    4    5    5    5    6    7    8    7    7    7    7
## 3분기         2    5    5    5    5    6    7    7    7    7    7    7
## 4분기         3    4    5    5    5    6    7    7    7    7    7    0
</code></pre>

<h3>데이터의 선택적 부분지정:</h3>

<p>이제 “하나투어”에 해당하는 자료를 뽑고, 그 중에서도 “4분기”에 해당하는
레코드를 뽑고자 합니다.</p>

<pre><code class="r">subset(x = mydatax, subset = (여행사 == &quot;하나투어&quot; &amp; 분기 == &quot;4분기&quot;))
</code></pre>

<pre><code>##    광고선전비 교육훈련비    매출액   여행사 번호 년도  분기
## 1   1.617e+08   18002000 5.616e+09 하나투어    1 2000 4분기
## 5   2.780e+07   16838062 7.799e+09 하나투어    5 2001 4분기
## 9   5.285e+08    8138020 1.268e+10 하나투어    9 2002 4분기
## 13  4.389e+08   14812754 1.565e+10 하나투어   13 2003 4분기
## 17  1.035e+09   54309865 1.986e+10 하나투어   17 2004 4분기
## 21  1.372e+09   62163640 2.712e+10 하나투어   21 2005 4분기
## 25  2.393e+09  102367110 4.604e+10 하나투어   25 2006 4분기
## 29  1.771e+09   40011868 4.642e+10 하나투어   29 2007 4분기
## 33  7.275e+08   -3735654 2.773e+10 하나투어   33 2008 4분기
## 37  5.282e+08  -20830938 2.879e+10 하나투어   37 2009 4분기
## 41  2.930e+09   98244331 5.494e+10 하나투어   41 2010 4분기
</code></pre>

<p>위에서 조건에 맞는 레코드들을 추출했지만, 변수가 모두 필요한 것은
아닙니다. 따라서, 교육훈련비, 년도, 분기 세가지 변수만 뽑아봅니다.</p>

<pre><code class="r">subset(x = mydatax, subset = (여행사 == &quot;하나투어&quot; &amp; 분기 == &quot;4분기&quot;), 
    select = c(교육훈련비, 년도, 분기))
</code></pre>

<pre><code>##    교육훈련비 년도  분기
## 1    18002000 2000 4분기
## 5    16838062 2001 4분기
## 9     8138020 2002 4분기
## 13   14812754 2003 4분기
## 17   54309865 2004 4분기
## 21   62163640 2005 4분기
## 25  102367110 2006 4분기
## 29   40011868 2007 4분기
## 33   -3735654 2008 4분기
## 37  -20830938 2009 4분기
## 41   98244331 2010 4분기
</code></pre>

<h3>그룹별 연산하기:</h3>

<p>평균교육훈련비를 연도별로 산출한 뒤, 연도별 분할표를 생성해봅니다.</p>

<pre><code class="r">as.data.frame(as.table(with(mydatax, tapply(교육훈련비, 년도, mean))))
</code></pre>

<pre><code>##    Var1     Freq
## 1  2000  3328270
## 2  2001 10320313
## 3  2002  7423926
## 4  2003  9416275
## 5  2004  8417142
## 6  2005  7416239
## 7  2006 15046704
## 8  2007 22127430
## 9  2008 21516616
## 10 2009 10721259
## 11 2010 21786660
## 12 2011 21945286
</code></pre>

<h3>연산자 활용:</h3>

<p>여기에서부터는 2008, 2009, 2010 년에서 1분기와 3분기에 해당하는
“다트8”이라는 데이터를 생성하여 작업하도록 하겠습니다. 그 이유는 단순히
결과를 효과적으로 보여주기 위해서입니다.</p>

<pre><code class="r">다트8 &lt;- subset(mydatax, subset = (년도 %in% c(&quot;2008&quot;, &quot;2009&quot;, &quot;2010&quot;) &amp; 
    분기 %in% c(&quot;1분기&quot;, &quot;3분기&quot;)))
다트8
</code></pre>

<pre><code>##     광고선전비 교육훈련비    매출액       여행사 번호 년도  분기
## 30   1.433e+09   10453124 5.762e+10     하나투어   30 2008 1분기
## 32   1.398e+09   15837118 4.352e+10     하나투어   32 2008 3분기
## 34   5.288e+08   10678454 3.063e+10     하나투어   34 2009 1분기
## 36   6.797e+08    5375226 3.485e+10     하나투어   36 2009 3분기
## 38   1.056e+09   44554342 4.848e+10     하나투어   38 2010 1분기
## 40   1.723e+09          0 6.625e+10     하나투어   40 2010 3분기
## 77   0.000e+00          0 1.993e+10   레드캡투어   33 2008 1분기
## 79   2.748e+09  145562000 1.927e+10   레드캡투어   35 2008 3분기
## 81   2.154e+08    5027000 2.086e+10   레드캡투어   37 2009 1분기
## 83   5.037e+08   30857000 2.020e+10   레드캡투어   39 2009 3분기
## 85   2.853e+08    3554000 2.627e+10   레드캡투어   41 2010 1분기
## 87   3.774e+08   50701000 2.859e+10   레드캡투어   43 2010 3분기
## 104  1.204e+09   13200204 2.653e+10     모두투어   13 2008 1분기
## 106  1.461e+09   34482480 2.314e+10     모두투어   15 2008 3분기
## 108  5.445e+08    4611600 1.304e+10     모두투어   17 2009 1분기
## 110  5.865e+08    6552350 1.783e+10     모두투어   19 2009 3분기
## 112  6.271e+08   11581130 2.500e+10     모두투어   21 2010 1분기
## 114  1.266e+09   20890280 3.647e+10     모두투어   23 2010 3분기
## 149  9.301e+08   29007679 1.646e+10         세중   31 2008 1분기
## 151  2.675e+08    9583390 1.916e+10         세중   33 2008 3분기
## 153  1.290e+08    1252642 1.360e+10         세중   35 2009 1분기
## 155  5.688e+07    6980850 1.613e+10         세중   37 2009 3분기
## 157  9.224e+07   15798800 1.481e+10         세중   39 2010 1분기
## 159  4.900e+07   -4759221 2.028e+10         세중   41 2010 3분기
## 191  9.777e+08   23188682 1.295e+10 롯데관광개발    9 2008 1분기
## 193  1.158e+09   36495000 1.080e+10 롯데관광개발   11 2008 3분기
## 195  4.776e+08   19607350 5.582e+09 롯데관광개발   13 2009 1분기
## 197  6.001e+08   28783950 7.726e+09 롯데관광개발   15 2009 3분기
## 199  6.602e+08   28187000 7.761e+09 롯데관광개발   17 2010 1분기
## 201  6.092e+08   30269450 1.256e+10 롯데관광개발   19 2010 3분기
## 232  9.756e+08     100000 4.803e+09     자유투어   27 2008 1분기
## 234  1.311e+09    2480800 4.250e+09     자유투어   29 2008 3분기
## 236  6.533e+08    1066590 4.824e+09     자유투어   31 2009 1분기
## 238  6.502e+08    -706010 7.023e+09     자유투어   33 2009 3분기
## 240  8.172e+08     516680 1.132e+10     자유투어   35 2010 1분기
## 242  9.322e+08     852300 1.046e+10     자유투어   37 2010 3분기
## 275  1.065e+08    2848200 1.013e+09   비티앤아이   29 2008 1분기
## 277  2.060e+08   13846645 3.704e+09   비티앤아이   31 2008 3분기
## 279  8.156e+07   13427260 2.543e+09   비티앤아이   33 2009 1분기
## 281  1.202e+08     720000 2.677e+09   비티앤아이   35 2009 3분기
## 283  1.168e+08    2240000 2.270e+09   비티앤아이   37 2010 1분기
## 285  1.482e+08    6260000 4.987e+09   비티앤아이   39 2010 3분기
</code></pre>

<p>현재 여행사는 데이터를 그룹화 할 수 있는 고유한 키라고 할 수 있습니다.</p>

<h3>정렬하기:</h3>

<p>그런데, 이 데이터에 특징이 하나 있다면 그것은 동일한 여행사로부터 매년
분기별로 여러번 반복하여 얻은 데이터라는 것입니다. 따라서, 간혹 데이터를
여행사별로 정렬하기보다는 년도별로 정렬하고 싶을 경우가 있습니다. 이런
경우는 아래와 같이 합니다.</p>

<pre><code class="r">다트8[order(다트8$년도), ]
</code></pre>

<pre><code>##     광고선전비 교육훈련비    매출액       여행사 번호 년도  분기
## 30   1.433e+09   10453124 5.762e+10     하나투어   30 2008 1분기
## 32   1.398e+09   15837118 4.352e+10     하나투어   32 2008 3분기
## 77   0.000e+00          0 1.993e+10   레드캡투어   33 2008 1분기
## 79   2.748e+09  145562000 1.927e+10   레드캡투어   35 2008 3분기
## 104  1.204e+09   13200204 2.653e+10     모두투어   13 2008 1분기
## 106  1.461e+09   34482480 2.314e+10     모두투어   15 2008 3분기
## 149  9.301e+08   29007679 1.646e+10         세중   31 2008 1분기
## 151  2.675e+08    9583390 1.916e+10         세중   33 2008 3분기
## 191  9.777e+08   23188682 1.295e+10 롯데관광개발    9 2008 1분기
## 193  1.158e+09   36495000 1.080e+10 롯데관광개발   11 2008 3분기
## 232  9.756e+08     100000 4.803e+09     자유투어   27 2008 1분기
## 234  1.311e+09    2480800 4.250e+09     자유투어   29 2008 3분기
## 275  1.065e+08    2848200 1.013e+09   비티앤아이   29 2008 1분기
## 277  2.060e+08   13846645 3.704e+09   비티앤아이   31 2008 3분기
## 34   5.288e+08   10678454 3.063e+10     하나투어   34 2009 1분기
## 36   6.797e+08    5375226 3.485e+10     하나투어   36 2009 3분기
## 81   2.154e+08    5027000 2.086e+10   레드캡투어   37 2009 1분기
## 83   5.037e+08   30857000 2.020e+10   레드캡투어   39 2009 3분기
## 108  5.445e+08    4611600 1.304e+10     모두투어   17 2009 1분기
## 110  5.865e+08    6552350 1.783e+10     모두투어   19 2009 3분기
## 153  1.290e+08    1252642 1.360e+10         세중   35 2009 1분기
## 155  5.688e+07    6980850 1.613e+10         세중   37 2009 3분기
## 195  4.776e+08   19607350 5.582e+09 롯데관광개발   13 2009 1분기
## 197  6.001e+08   28783950 7.726e+09 롯데관광개발   15 2009 3분기
## 236  6.533e+08    1066590 4.824e+09     자유투어   31 2009 1분기
## 238  6.502e+08    -706010 7.023e+09     자유투어   33 2009 3분기
## 279  8.156e+07   13427260 2.543e+09   비티앤아이   33 2009 1분기
## 281  1.202e+08     720000 2.677e+09   비티앤아이   35 2009 3분기
## 38   1.056e+09   44554342 4.848e+10     하나투어   38 2010 1분기
## 40   1.723e+09          0 6.625e+10     하나투어   40 2010 3분기
## 85   2.853e+08    3554000 2.627e+10   레드캡투어   41 2010 1분기
## 87   3.774e+08   50701000 2.859e+10   레드캡투어   43 2010 3분기
## 112  6.271e+08   11581130 2.500e+10     모두투어   21 2010 1분기
## 114  1.266e+09   20890280 3.647e+10     모두투어   23 2010 3분기
## 157  9.224e+07   15798800 1.481e+10         세중   39 2010 1분기
## 159  4.900e+07   -4759221 2.028e+10         세중   41 2010 3분기
## 199  6.602e+08   28187000 7.761e+09 롯데관광개발   17 2010 1분기
## 201  6.092e+08   30269450 1.256e+10 롯데관광개발   19 2010 3분기
## 240  8.172e+08     516680 1.132e+10     자유투어   35 2010 1분기
## 242  9.322e+08     852300 1.046e+10     자유투어   37 2010 3분기
## 283  1.168e+08    2240000 2.270e+09   비티앤아이   37 2010 1분기
## 285  1.482e+08    6260000 4.987e+09   비티앤아이   39 2010 3분기
</code></pre>

<h5>중복되는 데이터의 처음과 끝 확인하기</h5>

<p>또 다른 경우는 각 년도별로 첫번째 레코드가 무엇인지 마지막 레코드가
무엇인지 알고 싶을 경우가 있습니다. 이런 경우는 아래와 같이 할 수
있습니다.</p>

<pre><code class="r">다트8.1 &lt;- 다트8[order(다트8$년도), ]
다트8.1$first &lt;- !duplicated(다트8.1$년도)
다트8.1
</code></pre>

<pre><code>##     광고선전비 교육훈련비    매출액       여행사 번호 년도  분기 first
## 30   1.433e+09   10453124 5.762e+10     하나투어   30 2008 1분기  TRUE
## 32   1.398e+09   15837118 4.352e+10     하나투어   32 2008 3분기 FALSE
## 77   0.000e+00          0 1.993e+10   레드캡투어   33 2008 1분기 FALSE
## 79   2.748e+09  145562000 1.927e+10   레드캡투어   35 2008 3분기 FALSE
## 104  1.204e+09   13200204 2.653e+10     모두투어   13 2008 1분기 FALSE
## 106  1.461e+09   34482480 2.314e+10     모두투어   15 2008 3분기 FALSE
## 149  9.301e+08   29007679 1.646e+10         세중   31 2008 1분기 FALSE
## 151  2.675e+08    9583390 1.916e+10         세중   33 2008 3분기 FALSE
## 191  9.777e+08   23188682 1.295e+10 롯데관광개발    9 2008 1분기 FALSE
## 193  1.158e+09   36495000 1.080e+10 롯데관광개발   11 2008 3분기 FALSE
## 232  9.756e+08     100000 4.803e+09     자유투어   27 2008 1분기 FALSE
## 234  1.311e+09    2480800 4.250e+09     자유투어   29 2008 3분기 FALSE
## 275  1.065e+08    2848200 1.013e+09   비티앤아이   29 2008 1분기 FALSE
## 277  2.060e+08   13846645 3.704e+09   비티앤아이   31 2008 3분기 FALSE
## 34   5.288e+08   10678454 3.063e+10     하나투어   34 2009 1분기  TRUE
## 36   6.797e+08    5375226 3.485e+10     하나투어   36 2009 3분기 FALSE
## 81   2.154e+08    5027000 2.086e+10   레드캡투어   37 2009 1분기 FALSE
## 83   5.037e+08   30857000 2.020e+10   레드캡투어   39 2009 3분기 FALSE
## 108  5.445e+08    4611600 1.304e+10     모두투어   17 2009 1분기 FALSE
## 110  5.865e+08    6552350 1.783e+10     모두투어   19 2009 3분기 FALSE
## 153  1.290e+08    1252642 1.360e+10         세중   35 2009 1분기 FALSE
## 155  5.688e+07    6980850 1.613e+10         세중   37 2009 3분기 FALSE
## 195  4.776e+08   19607350 5.582e+09 롯데관광개발   13 2009 1분기 FALSE
## 197  6.001e+08   28783950 7.726e+09 롯데관광개발   15 2009 3분기 FALSE
## 236  6.533e+08    1066590 4.824e+09     자유투어   31 2009 1분기 FALSE
## 238  6.502e+08    -706010 7.023e+09     자유투어   33 2009 3분기 FALSE
## 279  8.156e+07   13427260 2.543e+09   비티앤아이   33 2009 1분기 FALSE
## 281  1.202e+08     720000 2.677e+09   비티앤아이   35 2009 3분기 FALSE
## 38   1.056e+09   44554342 4.848e+10     하나투어   38 2010 1분기  TRUE
## 40   1.723e+09          0 6.625e+10     하나투어   40 2010 3분기 FALSE
## 85   2.853e+08    3554000 2.627e+10   레드캡투어   41 2010 1분기 FALSE
## 87   3.774e+08   50701000 2.859e+10   레드캡투어   43 2010 3분기 FALSE
## 112  6.271e+08   11581130 2.500e+10     모두투어   21 2010 1분기 FALSE
## 114  1.266e+09   20890280 3.647e+10     모두투어   23 2010 3분기 FALSE
## 157  9.224e+07   15798800 1.481e+10         세중   39 2010 1분기 FALSE
## 159  4.900e+07   -4759221 2.028e+10         세중   41 2010 3분기 FALSE
## 199  6.602e+08   28187000 7.761e+09 롯데관광개발   17 2010 1분기 FALSE
## 201  6.092e+08   30269450 1.256e+10 롯데관광개발   19 2010 3분기 FALSE
## 240  8.172e+08     516680 1.132e+10     자유투어   35 2010 1분기 FALSE
## 242  9.322e+08     852300 1.046e+10     자유투어   37 2010 3분기 FALSE
## 283  1.168e+08    2240000 2.270e+09   비티앤아이   37 2010 1분기 FALSE
## 285  1.482e+08    6260000 4.987e+09   비티앤아이   39 2010 3분기 FALSE
</code></pre>

<p>이와 유사한 논리로 각 년도별 마지막 레코드를 활용하고자 하는 지시자를
생성할 수도 있습니다.</p>

<pre><code class="r">다트8.1$last &lt;- !duplicated(다트8.1$년도, fromLast = TRUE)
다트8.1
</code></pre>

<pre><code>##     광고선전비 교육훈련비    매출액       여행사 번호 년도  분기 first
## 30   1.433e+09   10453124 5.762e+10     하나투어   30 2008 1분기  TRUE
## 32   1.398e+09   15837118 4.352e+10     하나투어   32 2008 3분기 FALSE
## 77   0.000e+00          0 1.993e+10   레드캡투어   33 2008 1분기 FALSE
## 79   2.748e+09  145562000 1.927e+10   레드캡투어   35 2008 3분기 FALSE
## 104  1.204e+09   13200204 2.653e+10     모두투어   13 2008 1분기 FALSE
## 106  1.461e+09   34482480 2.314e+10     모두투어   15 2008 3분기 FALSE
## 149  9.301e+08   29007679 1.646e+10         세중   31 2008 1분기 FALSE
## 151  2.675e+08    9583390 1.916e+10         세중   33 2008 3분기 FALSE
## 191  9.777e+08   23188682 1.295e+10 롯데관광개발    9 2008 1분기 FALSE
## 193  1.158e+09   36495000 1.080e+10 롯데관광개발   11 2008 3분기 FALSE
## 232  9.756e+08     100000 4.803e+09     자유투어   27 2008 1분기 FALSE
## 234  1.311e+09    2480800 4.250e+09     자유투어   29 2008 3분기 FALSE
## 275  1.065e+08    2848200 1.013e+09   비티앤아이   29 2008 1분기 FALSE
## 277  2.060e+08   13846645 3.704e+09   비티앤아이   31 2008 3분기 FALSE
## 34   5.288e+08   10678454 3.063e+10     하나투어   34 2009 1분기  TRUE
## 36   6.797e+08    5375226 3.485e+10     하나투어   36 2009 3분기 FALSE
## 81   2.154e+08    5027000 2.086e+10   레드캡투어   37 2009 1분기 FALSE
## 83   5.037e+08   30857000 2.020e+10   레드캡투어   39 2009 3분기 FALSE
## 108  5.445e+08    4611600 1.304e+10     모두투어   17 2009 1분기 FALSE
## 110  5.865e+08    6552350 1.783e+10     모두투어   19 2009 3분기 FALSE
## 153  1.290e+08    1252642 1.360e+10         세중   35 2009 1분기 FALSE
## 155  5.688e+07    6980850 1.613e+10         세중   37 2009 3분기 FALSE
## 195  4.776e+08   19607350 5.582e+09 롯데관광개발   13 2009 1분기 FALSE
## 197  6.001e+08   28783950 7.726e+09 롯데관광개발   15 2009 3분기 FALSE
## 236  6.533e+08    1066590 4.824e+09     자유투어   31 2009 1분기 FALSE
## 238  6.502e+08    -706010 7.023e+09     자유투어   33 2009 3분기 FALSE
## 279  8.156e+07   13427260 2.543e+09   비티앤아이   33 2009 1분기 FALSE
## 281  1.202e+08     720000 2.677e+09   비티앤아이   35 2009 3분기 FALSE
## 38   1.056e+09   44554342 4.848e+10     하나투어   38 2010 1분기  TRUE
## 40   1.723e+09          0 6.625e+10     하나투어   40 2010 3분기 FALSE
## 85   2.853e+08    3554000 2.627e+10   레드캡투어   41 2010 1분기 FALSE
## 87   3.774e+08   50701000 2.859e+10   레드캡투어   43 2010 3분기 FALSE
## 112  6.271e+08   11581130 2.500e+10     모두투어   21 2010 1분기 FALSE
## 114  1.266e+09   20890280 3.647e+10     모두투어   23 2010 3분기 FALSE
## 157  9.224e+07   15798800 1.481e+10         세중   39 2010 1분기 FALSE
## 159  4.900e+07   -4759221 2.028e+10         세중   41 2010 3분기 FALSE
## 199  6.602e+08   28187000 7.761e+09 롯데관광개발   17 2010 1분기 FALSE
## 201  6.092e+08   30269450 1.256e+10 롯데관광개발   19 2010 3분기 FALSE
## 240  8.172e+08     516680 1.132e+10     자유투어   35 2010 1분기 FALSE
## 242  9.322e+08     852300 1.046e+10     자유투어   37 2010 3분기 FALSE
## 283  1.168e+08    2240000 2.270e+09   비티앤아이   37 2010 1분기 FALSE
## 285  1.482e+08    6260000 4.987e+09   비티앤아이   39 2010 3분기 FALSE
##      last
## 30  FALSE
## 32  FALSE
## 77  FALSE
## 79  FALSE
## 104 FALSE
## 106 FALSE
## 149 FALSE
## 151 FALSE
## 191 FALSE
## 193 FALSE
## 232 FALSE
## 234 FALSE
## 275 FALSE
## 277  TRUE
## 34  FALSE
## 36  FALSE
## 81  FALSE
## 83  FALSE
## 108 FALSE
## 110 FALSE
## 153 FALSE
## 155 FALSE
## 195 FALSE
## 197 FALSE
## 236 FALSE
## 238 FALSE
## 279 FALSE
## 281  TRUE
## 38  FALSE
## 40  FALSE
## 85  FALSE
## 87  FALSE
## 112 FALSE
## 114 FALSE
## 157 FALSE
## 159 FALSE
## 199 FALSE
## 201 FALSE
## 240 FALSE
## 242 FALSE
## 283 FALSE
## 285  TRUE
</code></pre>

<h3>데이터를 종횡과 횡형으로 변형하기</h3>

<p>이렇게 처음과 마지막 레코드를 확인할 수 있는 지시자를 이용하여 어떤
분석자는 “다트8.1”과 같은 데이터가 주어졌을때, 각 여행사별로 2008년
1분기 매출액과 2010년 4분기의 매출액을 비교하여 그 차이를 알아내기
위해서 아래와 같은 데이터를 조작할 수 있습니다.</p>

<pre><code class="r">다트8.2 &lt;- 다트8.1[c(FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, 
    FALSE)]
다트8.3 &lt;- 다트8.2[order(다트8.2$여행사, 다트8.2$년도), ]
다트8.3$first &lt;- !duplicated(다트8.3$여행사)
다트8.3$last &lt;- !duplicated(다트8.3$여행사, fromLast = TRUE)
다트8.4 &lt;- subset(다트8.3, subset = (first == TRUE | last == TRUE))
</code></pre>

<p>처음과 마지막 레코드를 명시하는 지시자는 불필요하므로 데이터로부터
제거합니다.</p>

<pre><code class="r">다트8.5 &lt;- 다트8.4[, -c(4:5)]
다트8.5
</code></pre>

<pre><code>##        매출액       여행사 년도
## 149 1.646e+10         세중 2008
## 159 2.028e+10         세중 2010
## 30  5.762e+10     하나투어 2008
## 104 2.653e+10     모두투어 2008
## 232 4.803e+09     자유투어 2008
## 40  6.625e+10     하나투어 2010
## 114 3.647e+10     모두투어 2010
## 242 1.046e+10     자유투어 2010
## 77  1.993e+10   레드캡투어 2008
## 275 1.013e+09   비티앤아이 2008
## 87  2.859e+10   레드캡투어 2010
## 285 4.987e+09   비티앤아이 2010
## 191 1.295e+10 롯데관광개발 2008
## 201 1.256e+10 롯데관광개발 2010
</code></pre>

<p>그런데, 데이터가 종형으로 배열되어 있기 때문에 2008년과 2010년 매출액의
차이를 쉽게 구할 수 없습니다. 그래서, 아래와 같이 데이터를 횡형으로
재배열 해야 합니다.</p>

<pre><code class="r">다트8.6 &lt;- reshape(다트8.5, timevar = &quot;년도&quot;, idvar = &quot;여행사&quot;, direction = &quot;wide&quot;)
</code></pre>

<p>이제서야 원하는 차이를 구할 수 있습니다.</p>

<pre><code class="r">다트8.6$차이 &lt;- with(다트8.6, 매출액.2010 - 매출액.2008)
다트8.6
</code></pre>

<pre><code>##           여행사 매출액.2008 매출액.2010       차이
## 149         세중   1.646e+10   2.028e+10 3819526074
## 30      하나투어   5.762e+10   6.625e+10 8620920563
## 104     모두투어   2.653e+10   3.647e+10 9936013304
## 232     자유투어   4.803e+09   1.046e+10 5652396812
## 77    레드캡투어   1.993e+10   2.859e+10 8663065239
## 275   비티앤아이   1.013e+09   4.987e+09 3973623425
## 191 롯데관광개발   1.295e+10   1.256e+10 -393383321
</code></pre>

<p>위에서는 종형으로 이루어진 데이터를 횡형으로 변경하였으나, 우리는 이
횡형으로 된 데이터를 다시 종형으로도 되돌릴 수 있습니다. 이와 같이 하기
위해서는 아래와 같이 하면 됩니다.</p>

<pre><code class="r">reshape(다트8.6, v.names = c(&quot;매출액&quot;), varying = c(&quot;매출액.2008&quot;, &quot;매출액.2010&quot;), 
    direction = &quot;long&quot;, timevar = c(&quot;년도&quot;), times = c(&quot;2008&quot;, &quot;2010&quot;), ids = row.names(다트8.6))
</code></pre>

<pre><code>##                여행사       차이 년도    매출액  id
## 149.2008         세중 3819526074 2008 1.646e+10 149
## 30.2008      하나투어 8620920563 2008 5.762e+10  30
## 104.2008     모두투어 9936013304 2008 2.653e+10 104
## 232.2008     자유투어 5652396812 2008 4.803e+09 232
## 77.2008    레드캡투어 8663065239 2008 1.993e+10  77
## 275.2008   비티앤아이 3973623425 2008 1.013e+09 275
## 191.2008 롯데관광개발 -393383321 2008 1.295e+10 191
## 149.2010         세중 3819526074 2010 2.028e+10 149
## 30.2010      하나투어 8620920563 2010 6.625e+10  30
## 104.2010     모두투어 9936013304 2010 3.647e+10 104
## 232.2010     자유투어 5652396812 2010 1.046e+10 232
## 77.2010    레드캡투어 8663065239 2010 2.859e+10  77
## 275.2010   비티앤아이 3973623425 2010 4.987e+09 275
## 191.2010 롯데관광개발 -393383321 2010 1.256e+10 191
</code></pre>

<p>현재의 데이터셋을 가지고 보여줄 수 있는 추가적인 사항들 – (지금 이것들
전부다 문자열과 관계되는 부분임)</p>

<ul>
<li><p>두 문자형 변수 결합하기</p></li>
<li><p>특정 문자열 뽑아내기</p></li>
<li><p>변수의 길이 파악하기</p></li>
</ul>

<p>아래와 같은 내용을 보여주기 위해서는 다른 데이터셋이 필요함</p>

<ul>
<li><p>주어진 데이터셋으로부터 랜덤샘플 추출하기</p></li>
<li><p>데이터셋 합치기와 머지하기</p></li>
<li><p>대소문자 전환</p></li>
<li><p>시간과 날짜 데이터 다루기</p></li>
</ul>

<h2>추가적인 유용한 조작팁들</h2>

<h5>결측치를 바로 윗값으로 채워넣기:</h5>

<p>아래와 같이 주어진 데이터에 변수 ID는 결측값 없이 모든 값이 완전하게 잘
들어가 있는데, Week 변수에는 각 ID의 첫번째 레코드에만 해당하는 부분에
값이 들어가 있고 나머지부분에는 <code>NA</code>값이 들어가 있습니다.</p>

<p>mydata &lt;- data.frame(ID=c(rep(1,4), rep(2,4), rep(3,2)), Week=c(15, NA,
NA, NA, 18, NA, NA, NA, 20, NA))</p>

<p>&gt; mydata</p>

<p>ID Week 1 1 15 2 1 NA 3 1 NA 4 1 NA 5 2 18 6 2 NA 7 2 NA 8 2 NA 9 3 20
10 3 NA</p>

<p>이와 같은 데이터를 아래와 같이 자동으로 채워주려면 어떻게 해야 할까요?</p>

<p>ID Week 1 1 15 2 1 15 3 1 15 4 1 15 5 2 18 6 2 18 7 2 18 8 2 18 9 3 20
10 3 20</p>

<p>이를 수행하는데에는 여러 가지 종류의 함수들이 다양한 패지키 안에
존재합니다. 그러나, 이를 수행하는 기본 알고리즘은 동일하며, R
기본시스템만으로 작성이 가능합니다. 아래의 함수를 복사하여 사용하시면
됩니다.</p>

<p>fill &lt;- function(x, first, last) n &lt;- last-first+1 for(i in
c(1:length(first))) x[first[i]:last[i]] &lt;- rep(x[first[i]], n[i])
return(x)</p>

<h5>TODO:</h5>

<ul>
<li><p>그룹별 연산하는 방법에 대해서 설명을 해줘야 함 – aggregate(),
tapply(), mapply(), sapply(), lapply(),</p></li>
<li><p>여기에서는 데이터 조작만으로 한정짓고, 통계량을 구하는 방법은 모두
통계 파트로 넘김 – 즉, apply()계열의 함수를 모두 통계파트로 넘김.</p></li>
<li><p>expand.grid() 이건 수치해석 쪽으로 넘김.</p></li>
<li><p>gl() 은 여기에서 다루어야 함.</p></li>
</ul>

</body>

</html>
